<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visiona Titan - Ultimate Edition</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* =========================================
           1. VARIABLES & TH√àMES
           ========================================= */
        :root {
            --bg-color: #0f0f0f;
            --header-bg: #0f0f0f;
            --sidebar-bg: #0f0f0f;
            --card-bg: #0f0f0f;
            --text-main: #ffffff;
            --text-sec: #aaaaaa;
            --border-color: #2a2a2a;
            --hover-color: #272727;
            --accent-blue: #3ea6ff;
            --accent-red: #ff0000;
            --accent-gold: #ffc107;
            --accent-green: #2ba640;
            --sidebar-width: 240px;
            --header-height: 56px;
            --transition-speed: 0.2s;
        }

        /* TH√àME NO√ãL (Activ√© par l'Easter Egg) */
        body.christmas-mode {
            --bg-color: #0b1d0e;
            --header-bg: #1a0505;
            --sidebar-bg: #0f2b15;
            --accent-blue: #00ff00;
            --accent-red: #ff0000;
            background-image: url('https://www.transparenttextures.com/patterns/snow.png');
        }

        /* =========================================
           2. RESET & BASE
           ========================================= */
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0; padding: 0;
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Roboto', sans-serif;
            overflow-x: hidden;
            transition: background-color 0.5s ease;
        }

        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--bg-color); }
        ::-webkit-scrollbar-thumb { background: #555; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #888; }

        /* =========================================
           3. HEADER (BARRE DU HAUT)
           ========================================= */
        header {
            position: fixed; top: 0; left: 0; right: 0;
            height: var(--header-height);
            background: var(--header-bg);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 16px;
            z-index: 2000;
            border-bottom: 1px solid var(--border-color);
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }

        .logo-section {
            display: flex; align-items: center; gap: 5px;
            cursor: pointer; user-select: none;
        }
        .logo-icon {
            color: var(--accent-red); font-size: 28px;
            transition: transform 0.3s;
        }
        .logo-text {
            font-size: 20px; font-weight: 700; letter-spacing: -1px;
            position: relative;
        }
        .logo-text span { font-weight: 300; color: var(--text-main); }
        
        /* Animation Logo No√´l */
        body.christmas-mode .logo-icon::after { content: 'üéÖ'; position: absolute; top: -10px; left: -10px; font-size: 20px; }

        .search-container {
            flex: 1; max-width: 650px; margin: 0 20px; display: flex;
        }
        .search-input {
            width: 100%;
            background: #121212;
            border: 1px solid var(--border-color);
            color: white;
            padding: 10px 15px;
            border-radius: 40px 0 0 40px;
            font-size: 16px;
            transition: border 0.2s;
        }
        .search-input:focus { border-color: var(--accent-blue); }
        .search-btn {
            background: #222;
            border: 1px solid var(--border-color);
            border-left: none;
            color: var(--text-sec);
            padding: 0 20px;
            border-radius: 0 40px 40px 0;
            cursor: pointer;
        }
        .search-btn:hover { background: #333; color: white; }

        .header-actions {
            display: flex; align-items: center; gap: 15px;
        }

        .icon-btn {
            background: none; border: none; color: white;
            font-size: 24px; cursor: pointer; padding: 8px;
            border-radius: 50%; transition: background 0.2s;
        }
        .icon-btn:hover { background: rgba(255,255,255,0.1); }

        .auth-btn {
            background: transparent;
            border: 1px solid var(--accent-blue);
            color: var(--accent-blue);
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex; align-items: center; gap: 5px;
        }
        .auth-btn:hover { background: rgba(62, 166, 255, 0.1); }

        .user-avatar-header {
            width: 32px; height: 32px; border-radius: 50%;
            background: #333; cursor: pointer; overflow: hidden;
            border: 1px solid var(--border-color);
        }
        .user-avatar-header img { width: 100%; height: 100%; object-fit: cover; }
        .user-avatar-header div { 
            width: 100%; height: 100%; display: flex; 
            align-items: center; justify-content: center; 
            font-weight: bold; color: white; 
        }

        /* =========================================
           4. SIDEBAR (NAVIGATION GAUCHE)
           ========================================= */
        .sidebar {
            position: fixed; top: var(--header-height); bottom: 0; left: 0;
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            overflow-y: auto;
            padding: 12px;
            z-index: 1000;
            transform: translateX(0);
            transition: transform 0.3s ease;
        }
        
        .nav-item {
            display: flex; align-items: center; gap: 20px;
            padding: 10px 12px;
            border-radius: 10px;
            cursor: pointer;
            color: var(--text-main);
            font-size: 14px;
            margin-bottom: 2px;
        }
        .nav-item:hover { background: var(--hover-color); }
        .nav-item.active { background: var(--hover-color); font-weight: 500; }
        .nav-icon { font-size: 18px; width: 24px; text-align: center; }

        .separator {
            border: 0; border-top: 1px solid var(--border-color);
            margin: 12px 0;
        }

        .section-title {
            font-size: 13px; font-weight: bold; color: var(--text-sec);
            padding: 8px 12px; text-transform: uppercase;
        }

        /* =========================================
           5. MAIN CONTENT (ZONE PRINCIPALE)
           ========================================= */
        .main-container {
            margin-top: var(--header-height);
            margin-left: var(--sidebar-width);
            padding: 24px;
            min-height: calc(100vh - var(--header-height));
            transition: margin-left 0.3s ease;
        }

        /* Grid Vid√©os */
        .video-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .video-card {
            cursor: pointer;
            transition: transform 0.2s;
        }
        .video-card:hover { transform: scale(1.02); }

        .thumbnail-container {
            position: relative;
            width: 100%;
            aspect-ratio: 16/9;
            background: #222;
            border-radius: 12px;
            overflow: hidden;
        }
        .thumbnail-img {
            width: 100%; height: 100%; object-fit: cover;
        }
        .duration-badge {
            position: absolute; bottom: 5px; right: 5px;
            background: rgba(0,0,0,0.8);
            color: white; padding: 2px 6px;
            border-radius: 4px; font-size: 12px; font-weight: 500;
        }
        .live-badge {
            position: absolute; top: 8px; left: 8px;
            background: var(--accent-red);
            color: white; padding: 2px 6px;
            border-radius: 4px; font-size: 12px; font-weight: bold;
            display: flex; align-items: center; gap: 4px;
        }
        .live-badge::before {
            content: ''; display: block; width: 6px; height: 6px;
            background: white; border-radius: 50%;
        }

        .video-info {
            display: flex; gap: 12px; margin-top: 12px;
        }
        .channel-avatar-small {
            width: 36px; height: 36px; border-radius: 50%;
            background: #333; flex-shrink: 0;
        }
        .video-title {
            font-size: 16px; font-weight: bold;
            line-height: 1.3; margin-bottom: 4px;
            display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical;
            overflow: hidden; color: var(--text-main);
        }
        .video-meta {
            font-size: 13px; color: var(--text-sec);
            display: flex; flex-direction: column;
        }
        .video-meta span:hover { color: var(--text-main); }

        /* =========================================
           6. ZAPPS (MODE VERTICAL)
           ========================================= */
        .zapp-container {
            height: calc(100vh - 80px);
            overflow-y: scroll;
            scroll-snap-type: y mandatory;
            max-width: 450px;
            margin: 0 auto;
            scrollbar-width: none;
        }
        .zapp-container::-webkit-scrollbar { display: none; }

        .zapp-item {
            height: 100%;
            scroll-snap-align: start;
            position: relative;
            background: #000;
            border-radius: 15px;
            margin-bottom: 20px;
            display: flex; justify-content: center;
            overflow: hidden;
        }
        .zapp-video {
            height: 100%; width: 100%; object-fit: cover;
        }
        .zapp-overlay {
            position: absolute; bottom: 0; left: 0; right: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
            padding: 20px;
            display: flex; align-items: flex-end; justify-content: space-between;
        }
        .zapp-actions {
            display: flex; flex-direction: column; gap: 20px; align-items: center;
        }
        .action-btn {
            background: rgba(255,255,255,0.1);
            width: 45px; height: 45px; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            flex-direction: column; color: white; cursor: pointer;
            backdrop-filter: blur(5px);
        }
        .action-btn small { font-size: 10px; margin-top: 2px; }

        /* =========================================
           7. MODALES (LOGIN, UPLOAD, ADMIN)
           ========================================= */
        .modal-overlay {
            display: none; position: fixed; inset: 0;
            background: rgba(0,0,0,0.8); z-index: 5000;
            align-items: center; justify-content: center;
            backdrop-filter: blur(5px);
        }
        .modal-box {
            background: #212121;
            padding: 25px;
            border-radius: 15px;
            width: 90%; max-width: 500px;
            border: 1px solid #333;
            animation: slideUp 0.3s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        .modal-header {
            display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;
        }
        .modal-title { font-size: 20px; font-weight: bold; }
        .close-btn { background: none; border: none; color: #aaa; font-size: 24px; cursor: pointer; }
        
        .form-group { margin-bottom: 15px; }
        .titan-input {
            width: 100%; background: #121212; border: 1px solid #333;
            color: white; padding: 12px; border-radius: 8px; font-family: inherit;
        }
        .titan-input:focus { border-color: var(--accent-blue); }
        
        .btn-primary {
            width: 100%; background: var(--accent-blue); color: black;
            padding: 12px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer;
        }
        .btn-danger {
            background: var(--accent-red); color: white;
        }
        
        /* =========================================
           8. PLAYER OVERLAY & ADMIN
           ========================================= */
        #player-overlay {
            display: none; position: fixed; inset: 0;
            background: var(--bg-color); z-index: 4000;
            overflow-y: auto; padding: 20px;
        }
        .player-layout {
            max-width: 1400px; margin: 0 auto;
            display: grid; grid-template-columns: 1fr 400px; gap: 24px;
        }
        
        .admin-panel-grid {
            display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }
        .stat-card {
            background: #1e1e1e; padding: 20px; border-radius: 10px; text-align: center;
        }

        /* Responsive Mobile */
        @media (max-width: 900px) {
            .sidebar { transform: translateX(-100%); }
            .sidebar.open { transform: translateX(0); }
            .main-container { margin-left: 0; }
            .player-layout { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo-section" onclick="app.easterEgg()">
            <div class="logo-icon">‚ñ∂</div>
            <div class="logo-text">Visiona<span>Titan</span></div>
        </div>

        <div class="search-container">
            <input type="text" class="search-input" id="search-input" placeholder="Rechercher..." onkeyup="if(event.key==='Enter') app.search()">
            <button class="search-btn" onclick="app.search()">üîç</button>
        </div>

        <div class="header-actions">
            <button class="icon-btn" onclick="app.openModal('modal-create')" title="Cr√©er">üìπ</button>
            
            <div style="position:relative;">
                <button class="icon-btn" onclick="alert('Aucune nouvelle notification.')">üîî</button>
                <div id="notif-badge" style="display:none; position:absolute; top:5px; right:5px; width:8px; height:8px; background:red; border-radius:50%;"></div>
            </div>

            <div id="auth-section">
                </div>
        </div>
    </header>

    <div id="user-dropdown" style="display:none; position:fixed; right:15px; top:60px; background:#282828; width:250px; border-radius:12px; z-index:4500; border:1px solid #333; box-shadow:0 10px 30px rgba(0,0,0,0.5);">
        <div style="padding:15px; border-bottom:1px solid #333; display:flex; align-items:center; gap:10px;">
            <div id="dropdown-pp" class="user-avatar-header"></div>
            <b id="dropdown-name" style="font-size:16px;">Pseudo</b>
        </div>
        <div class="nav-item" onclick="app.nav('profile')">üë§ Ma Cha√Æne</div>
        <div class="nav-item" onclick="app.nav('stats')">üìä Titan Studio (Stats)</div>
        <div id="admin-entry" class="nav-item" style="display:none; color:var(--accent-gold);" onclick="app.nav('admin')">üõ°Ô∏è Panel Admin</div>
        <div class="separator"></div>
        <div class="nav-item" onclick="app.logout()" style="color:var(--accent-red);">üö™ D√©connexion</div>
    </div>

    <nav class="sidebar" id="sidebar">
        <div class="nav-item active" id="btn-home" onclick="app.nav('home')">
            <span class="nav-icon">üè†</span> Accueil
        </div>
        <div class="nav-item" id="btn-zapp" onclick="app.nav('zapp')">
            <span class="nav-icon">‚ö°</span> Zapps
        </div>
        <div class="nav-item" id="btn-subs" onclick="app.nav('subs')">
            <span class="nav-icon">üì∫</span> Abonnements
        </div>
        
        <div class="separator"></div>
        
        <div class="nav-item" onclick="app.nav('history')">
            <span class="nav-icon">üïí</span> Historique
        </div>
        <div class="nav-item" onclick="app.nav('community')">
            <span class="nav-icon">üìù</span> Communaut√©
        </div>
        <div class="nav-item" onclick="app.nav('thanks')">
            <span class="nav-icon">üíé</span> Remerciements
        </div>

        <div class="separator"></div>
        <div class="section-title">Vos Abonnements</div>
        <div id="subs-list">
            </div>
    </nav>

    <main class="main-container">
        
        <section id="view-home">
            <div id="announcement-area"></div> <div class="video-grid" id="grid-home"></div>
        </section>

        <section id="view-zapp" style="display:none;">
            <div class="zapp-container" id="container-zapp"></div>
        </section>

        <section id="view-subs" style="display:none;">
            <h2>Vid√©os de vos abonnements</h2>
            <div class="video-grid" id="grid-subs"></div>
        </section>

        <section id="view-history" style="display:none;">
            <div style="display:flex; justify-content:space-between; margin-bottom:20px;">
                <h2>Historique de visionnage</h2>
                <button onclick="app.clearHistory()" style="background:none; border:none; color:var(--accent-blue); cursor:pointer;">Tout effacer</button>
            </div>
            <div class="video-grid" id="grid-history"></div>
        </section>

        <section id="view-community" style="display:none;">
            <h2>Flux Communaut√©</h2>
            <div id="community-feed"></div>
        </section>

        <section id="view-thanks" style="display:none;">
            <h1 style="color:var(--accent-gold); text-align:center;">üíé LE PANTH√âON TITAN</h1>
            <p style="text-align:center; color:#aaa;">Merci √† ceux qui soutiennent le projet.</p>
            <div id="thanks-list" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(200px, 1fr)); gap:20px; margin-top:30px;"></div>
        </section>

        <section id="view-admin" style="display:none;">
            <h1 style="color:var(--accent-red);">üõ°Ô∏è ADMINISTRATION SUPR√äME</h1>
            <div class="admin-panel-grid">
                <div class="stat-card">
                    <h3>Annonce Globale</h3>
                    <textarea id="admin-announcement" class="titan-input" style="height:60px;"></textarea>
                    <button class="btn-primary" style="margin-top:10px; background:var(--accent-green);" onclick="app.admin.postAnnounce()">PUBLIER</button>
                </div>
                <div class="stat-card">
                    <h3>Actions Rapides</h3>
                    <button class="btn-primary" style="background:var(--accent-red); margin-bottom:5px;" onclick="app.admin.resetAll()">‚ö†Ô∏è RESET TOTAL</button>
                    <button class="btn-primary" style="background:#555;" onclick="app.admin.addThanks()">Ajouter Remerciement</button>
                </div>
            </div>
            <h3>Gestion des Vid√©os</h3>
            <div id="admin-video-list" style="background:#1e1e1e; padding:10px; border-radius:10px;"></div>
        </section>

        <section id="view-profile" style="display:none;">
            <div id="profile-banner" style="width:100%; height:200px; background:#333; background-size:cover; border-radius:15px;"></div>
            <div style="display:flex; gap:20px; align-items:center; margin-top:-40px; padding:0 30px;">
                <div id="profile-pp" style="width:120px; height:120px; border-radius:50%; border:5px solid var(--bg-color); background:#222; overflow:hidden;"></div>
                <div style="margin-top:40px;">
                    <h1 id="profile-name" style="margin:0;">Nom</h1>
                    <p id="profile-stats" style="color:#aaa;">0 abonn√©s</p>
                    <p id="profile-bio" style="font-size:14px; margin-top:5px; max-width:600px;"></p>
                </div>
                <div style="margin-left:auto; margin-top:40px;">
                    <button id="btn-subscribe" class="btn-primary" style="background:white; color:black; border-radius:20px; padding:10px 25px;" onclick="app.toggleSubscribe()">S'ABONNER</button>
                    <button id="btn-customize" class="btn-primary" style="background:#333; color:white; border-radius:20px; padding:10px 25px; display:none;" onclick="app.openModal('modal-custom')">PERSONNALISER</button>
                </div>
            </div>
            <hr style="border-color:#333; margin:20px 0;">
            <h3>Vid√©os de la cha√Æne</h3>
            <div class="video-grid" id="profile-videos"></div>
        </section>

        <section id="view-stats" style="display:none;">
            <h1>üìä Titan Studio</h1>
            <div class="admin-panel-grid">
                <div class="stat-card">
                    <h2 id="stat-views" style="color:var(--accent-blue);">0</h2>
                    <p>Vues Totales</p>
                </div>
                <div class="stat-card">
                    <h2 id="stat-subs" style="color:var(--accent-gold);">0</h2>
                    <p>Abonn√©s</p>
                </div>
                <div class="stat-card">
                    <h2 id="stat-likes" style="color:var(--accent-green);">0</h2>
                    <p>J'aime re√ßus</p>
                </div>
            </div>
        </section>
    </main>

    <div id="modal-create" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <div class="modal-title">Cr√©er du contenu</div>
                <button class="close-btn" onclick="app.closeModals()">√ó</button>
            </div>
            <div style="display:flex; gap:10px; margin-bottom:20px;">
                <button class="btn-primary" onclick="app.switchUploadTab('upload')">IMPORTER VID√âO</button>
                <button class="btn-primary" style="background:var(--accent-red); color:white;" onclick="app.switchUploadTab('live')">LANCER DIRECT</button>
            </div>

            <div id="tab-upload">
                <input type="text" id="up-title" class="titan-input" placeholder="Titre de la vid√©o" style="margin-bottom:10px;">
                <textarea id="up-desc" class="titan-input" placeholder="Description..." style="margin-bottom:10px;"></textarea>
                <div class="form-group">
                    <label>Fichier Vid√©o</label>
                    <input type="file" id="up-file" class="titan-input" accept="video/*">
                </div>
                <div class="form-group">
                    <label>Miniature (Image)</label>
                    <input type="file" id="up-thumb" class="titan-input" accept="image/*">
                </div>
                <label style="display:flex; align-items:center; gap:10px; cursor:pointer;">
                    <input type="checkbox" id="up-is-short">
                    Est un Zapp (Format court vertical)
                </label>
                <button class="btn-primary" style="margin-top:20px;" onclick="app.processUpload()">METTRE EN LIGNE</button>
            </div>

            <div id="tab-live" style="display:none;">
                <input type="text" id="live-title" class="titan-input" placeholder="Titre du direct" style="margin-bottom:10px;">
                <div style="background:black; aspect-ratio:16/9; border-radius:8px; overflow:hidden; margin-bottom:10px;">
                    <video id="live-preview" autoplay muted style="width:100%; height:100%; object-fit:cover;"></video>
                </div>
                <div style="display:flex; gap:10px;">
                    <button class="btn-primary" style="background:#444;" onclick="app.startCam()">üì∑ CAM√âRA</button>
                    <button class="btn-primary" style="background:#444;" onclick="app.startScreen()">üíª √âCRAN</button>
                </div>
                <button class="btn-primary" style="background:var(--accent-red); margin-top:15px; color:white;" onclick="app.goLive()">PASSER EN DIRECT</button>
            </div>
        </div>
    </div>

    <div id="modal-auth" class="modal-overlay">
        <div class="modal-box" style="text-align:center;">
            <h2 style="color:var(--accent-blue);">Connexion Titan</h2>
            <input type="text" id="login-user" class="titan-input" placeholder="Nom d'utilisateur" style="margin-bottom:10px;">
            <button class="btn-primary" onclick="app.login()">SE CONNECTER</button>
            <p style="color:#666; font-size:12px; margin-top:15px;">Le compte sera cr√©√© s'il n'existe pas.</p>
            <button onclick="app.closeModals()" style="background:none; border:none; color:#aaa; cursor:pointer;">Fermer</button>
        </div>
    </div>

    <div id="modal-custom" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-header">
                <div class="modal-title">Personnaliser ma cha√Æne</div>
                <button class="close-btn" onclick="app.closeModals()">√ó</button>
            </div>
            <label>URL Banni√®re</label>
            <input type="text" id="cust-banner" class="titan-input" placeholder="https://..." style="margin-bottom:10px;">
            <label>URL Avatar</label>
            <input type="text" id="cust-pp" class="titan-input" placeholder="https://..." style="margin-bottom:10px;">
            <label>Bio</label>
            <textarea id="cust-bio" class="titan-input"></textarea>
            <button class="btn-primary" style="margin-top:15px;" onclick="app.saveProfile()">ENREGISTRER</button>
        </div>
    </div>

    <div id="player-overlay">
        <div class="player-layout">
            <div>
                <button onclick="app.closePlayer()" style="margin-bottom:10px; background:none; border:none; color:white; font-size:18px; cursor:pointer;">‚úï FERMER</button>
                <div style="width:100%; aspect-ratio:16/9; background:black; border-radius:12px; overflow:hidden; position:relative;">
                    <video id="main-player" controls autoplay style="width:100%; height:100%;"></video>
                    <button id="stop-live-btn" onclick="app.stopLive()" style="display:none; position:absolute; top:10px; right:10px; background:red; color:white; border:none; padding:5px 10px; cursor:pointer; font-weight:bold;">ARR√äTER LE LIVE</button>
                </div>
                
                <h1 id="p-title" style="font-size:20px; margin:15px 0 5px 0;">Titre vid√©o</h1>
                
                <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                    <div style="display:flex; align-items:center; gap:10px; cursor:pointer;" onclick="app.navToAuthor()">
                        <div id="p-author-pp" style="width:40px; height:40px; border-radius:50%; background:#444; overflow:hidden;"></div>
                        <div>
                            <b id="p-author-name">Auteur</b>
                            <div id="p-author-subs" style="font-size:12px; color:#aaa;">0 abonn√©s</div>
                        </div>
                        <button id="p-sub-btn" onclick="event.stopPropagation(); app.toggleSubscribePlayer()" style="margin-left:15px; background:white; color:black; border:none; padding:8px 16px; border-radius:20px; font-weight:bold; cursor:pointer;">S'ABONNER</button>
                    </div>

                    <div style="display:flex; gap:10px;">
                        <button onclick="app.vote(1)" style="background:#222; color:white; border:none; padding:8px 15px; border-radius:20px; cursor:pointer; display:flex; align-items:center; gap:5px;">
                            üëç <span id="p-likes">0</span>
                        </button>
                        <button onclick="app.vote(-1)" style="background:#222; color:white; border:none; padding:8px 15px; border-radius:20px; cursor:pointer;">
                            üëé
                        </button>
                    </div>
                </div>

                <div style="background:#1e1e1e; padding:15px; border-radius:10px; margin-top:15px;">
                    <b id="p-views-date" style="font-size:14px;">0 vues ‚Ä¢ Il y a 1h</b>
                    <p id="p-desc" style="font-size:14px; margin-top:10px; white-space:pre-wrap;">Description...</p>
                </div>

                <div style="margin-top:20px;">
                    <h3>Commentaires</h3>
                    <div style="display:flex; gap:10px; margin-bottom:20px;">
                        <div id="com-user-pp" style="width:40px; height:40px; border-radius:50%; background:#444;"></div>
                        <div style="flex:1;">
                            <input id="com-input" type="text" placeholder="Ajouter un commentaire..." style="width:100%; background:none; border:none; border-bottom:1px solid #333; color:white; padding:10px;">
                            <div style="text-align:right; margin-top:5px;">
                                <button onclick="app.postComment()" style="background:var(--accent-blue); border:none; padding:8px 16px; border-radius:20px; font-weight:bold; cursor:pointer;">Ajouter</button>
                            </div>
                        </div>
                    </div>
                    <div id="comments-list"></div>
                </div>
            </div>

            <div>
                <h3>√Ä suivre</h3>
                <div id="suggestions-list"></div>
            </div>
        </div>
    </div>
    <script>
        /* =========================================
           TITAN ENGINE v3.0 (ULTIMATE FIX)
           ========================================= */
        
        const GIST_URL = "https://gist.githubusercontent.com/AlphaGames30/5248424f9cc79feb78c0560faad87c92/raw/video.json";

        const app = {
            // --- ETAT GLOBAL ---
            data: {
                videos: [],
                users: {
                    "Edonis": { pp: "", banner: "", bio: "Le Cr√©ateur Supr√™me", subs: [], followers: [], role: "admin", created: Date.now() }
                },
                posts: [],
                announcements: [],
                thanks: ["Edonis - Cr√©ateur", "AlphaGames30 - Dev", "Toi - Testeur"]
            },
            currentUser: null,
            activeVideo: null,
            stream: null,
            easterEggCount: 0,
            
            // --- 1. INITIALISATION ---
            init: async function() {
                console.log("Titan Engine : D√©marrage...");
                
                // Charger utilisateur local
                const savedUser = localStorage.getItem('visiona_user');
                if(savedUser) this.currentUser = savedUser;

                // Charger Donn√©es (Gist ou Backup)
                await this.loadData();

                // Initialiser UI
                this.updateUI();
                this.nav('home');
                
                // Easter Egg Reset
                this.easterEggCount = 0;
            },

            loadData: async function() {
                try {
                    const r = await fetch(GIST_URL + "?t=" + Date.now());
                    if(!r.ok) throw new Error("Gist HS");
                    const json = await r.json();
                    
                    // Fusionner avec les donn√©es locales (pour ne pas perdre tes uploads locaux)
                    // Note: Dans une vraie app, tout viendrait du serveur. Ici, on garde la session.
                    this.data.users = { ...json.users, ...this.data.users };
                    this.data.videos = [ ...json.videos, ...this.data.videos ]; // On ajoute les vid√©os Gist aux locales
                    
                    console.log("Donn√©es charg√©es depuis le Cloud.");
                } catch(e) {
                    console.warn("Mode Hors-Ligne activ√©. Utilisation des donn√©es de secours.");
                    // Donn√©es de secours si Gist HS
                    this.data.videos = [
                        { id: 1, title: "Bienvenue sur Visiona Titan", author: "Edonis", views: 5000, date: Date.now(), url: "https://www.w3schools.com/html/mov_bbb.mp4", thumb: "https://via.placeholder.com/640x360", isShort: false, likes: 120, comments: [] },
                        { id: 2, title: "D√©mo Zapp", author: "Edonis", views: 1200, date: Date.now(), url: "https://www.w3schools.com/html/mov_bbb.mp4", thumb: "", isShort: true, likes: 50, comments: [] }
                    ];
                }
            },

            saveData: function() {
                // Simulation de sauvegarde Cloud (Ici on garde en m√©moire vive pour la session)
                // Pour persister les uploads entre refresh sans backend, c'est impossible avec des gros fichiers.
                // On met juste √† jour l'UI.
                this.updateUI();
            },

            // --- 2. NAVIGATION ---
            nav: function(page) {
                // Fermer tout
                document.querySelectorAll('section').forEach(el => el.style.display = 'none');
                document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
                
                // Ouvrir cible
                const target = document.getElementById('view-' + page);
                const btn = document.getElementById('btn-' + page);
                if(target) target.style.display = 'block';
                if(btn) btn.classList.add('active');

                // Actions sp√©cifiques
                if(page === 'home') this.renderHome();
                if(page === 'zapp') this.renderZapps();
                if(page === 'subs') this.renderSubs();
                if(page === 'history') this.renderHistory();
                if(page === 'community') this.renderCommunity();
                if(page === 'profile') this.renderProfile(this.currentUser);
                if(page === 'thanks') this.renderThanks();
                if(page === 'stats') this.renderStats();
                if(page === 'admin') this.renderAdmin();

                // Fermer menus
                document.getElementById('user-dropdown').style.display = 'none';
                window.scrollTo(0,0);
            },

            // --- 3. RENDU DES VUES ---
            renderHome: function() {
                const grid = document.getElementById('grid-home');
                const vids = this.data.videos.filter(v => !v.isShort).sort((a,b) => b.date - a.date);
                
                // Afficher annonce admin
                const annArea = document.getElementById('announcement-area');
                annArea.innerHTML = this.data.announcements.map(a => `<div style="background:var(--accent-blue); color:black; padding:10px; border-radius:8px; margin-bottom:15px; font-weight:bold;">üì¢ ${a}</div>`).join('');

                grid.innerHTML = vids.map(v => this.createCardHTML(v)).join('');
            },

            renderZapps: function() {
                const cont = document.getElementById('container-zapp');
                const vids = this.data.videos.filter(v => v.isShort);
                if(vids.length === 0) return cont.innerHTML = "<p style='text-align:center; padding-top:50px;'>Aucun Zapp disponible.</p>";
                
                cont.innerHTML = vids.map(v => `
                    <div class="zapp-item">
                        <video class="zapp-video" src="${v.url}" loop onclick="this.paused ? this.play() : this.pause()"></video>
                        <div class="zapp-overlay">
                            <div>
                                <b onclick="app.renderProfile('${v.author}')" style="cursor:pointer;">@${v.author}</b>
                                <p style="margin:5px 0; font-size:14px;">${v.title}</p>
                            </div>
                            <div class="zapp-actions">
                                <div class="action-btn" onclick="app.likeVideo(${v.id}, true)">‚ù§Ô∏è <small>${v.likes || 0}</small></div>
                                <div class="action-btn" onclick="app.openPlayer(${v.id})">üí¨</div>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderSubs: function() {
                if(!this.currentUser) return document.getElementById('grid-subs').innerHTML = "<p>Connectez-vous pour voir vos abonnements.</p>";
                const mySubs = this.data.users[this.currentUser]?.subs || [];
                const vids = this.data.videos.filter(v => mySubs.includes(v.author) && !v.isShort);
                document.getElementById('grid-subs').innerHTML = vids.length ? vids.map(v => this.createCardHTML(v)).join('') : "<p>Aucune vid√©o r√©cente.</p>";
            },

            renderCommunity: function() {
                const feed = document.getElementById('community-feed');
                // Formulaire post
                let html = "";
                if(this.currentUser) {
                    html += `
                    <div style="background:#1e1e1e; padding:15px; border-radius:10px; margin-bottom:20px;">
                        <textarea id="new-post-txt" class="titan-input" placeholder="Exprimez-vous..."></textarea>
                        <button class="btn-primary" style="margin-top:10px; width:auto;" onclick="app.addPost()">Publier</button>
                    </div>`;
                }
                // Liste posts
                html += this.data.posts.map(p => `
                    <div style="background:#1e1e1e; padding:15px; border-radius:10px; margin-bottom:15px; border:1px solid #333;">
                        <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                            ${this.getAvatarHTML(p.author, 30)}
                            <b>${p.author}</b> <span style="color:#aaa; font-size:12px;">${this.timeAgo(p.date)}</span>
                        </div>
                        <p>${p.text}</p>
                    </div>
                `).join('');
                feed.innerHTML = html;
            },

            renderProfile: function(username) {
                if(!username) return this.openModal('modal-auth');
                // Afficher la vue
                document.getElementById('view-home').style.display = 'none'; // Hack rapide pour forcer le switch
                document.getElementById('view-profile').style.display = 'block';

                // Si user inconnu, on le cr√©e temporairement pour l'affichage
                if(!this.data.users[username]) {
                    this.data.users[username] = { pp: "", banner: "", bio: "Membre Visiona", subs: [], followers: [], role: "user" };
                }
                const u = this.data.users[username];

                document.getElementById('profile-name').innerText = username;
                document.getElementById('profile-stats').innerText = `${u.followers.length} abonn√©s`;
                document.getElementById('profile-bio').innerText = u.bio;
                
                // Avatar & Banni√®re
                const ppDiv = document.getElementById('profile-pp');
                ppDiv.innerHTML = u.pp ? `<img src="${u.pp}" style="width:100%; height:100%; object-fit:cover;">` : this.getAvatarHTML(username, 120);
                if(u.banner) document.getElementById('profile-banner').style.backgroundImage = `url(${u.banner})`;

                // Boutons
                const isMe = (username === this.currentUser);
                document.getElementById('btn-customize').style.display = isMe ? 'inline-block' : 'none';
                document.getElementById('btn-subscribe').style.display = isMe ? 'none' : 'inline-block';
                
                if(!isMe) {
                    const amSub = this.data.users[this.currentUser]?.subs.includes(username);
                    const btn = document.getElementById('btn-subscribe');
                    btn.innerText = amSub ? "ABONN√â" : "S'ABONNER";
                    btn.style.background = amSub ? "#333" : "white";
                    btn.style.color = amSub ? "white" : "black";
                }

                // Vid√©os
                const vids = this.data.videos.filter(v => v.author === username && !v.isShort);
                document.getElementById('profile-videos').innerHTML = vids.map(v => this.createCardHTML(v)).join('');
            },

            // --- 4. PLAYER & LOGIQUE VID√âO ---
            openPlayer: function(id) {
                const v = this.data.videos.find(x => x.id === id);
                if(!v) return;
                this.activeVideo = v;

                const p = document.getElementById('player-overlay');
                const vid = document.getElementById('main-player');
                
                // SOURCE VID√âO
                if(v.isLive && v.streamObj) {
                    vid.srcObject = v.streamObj;
                    document.getElementById('stop-live-btn').style.display = (v.author === this.currentUser) ? 'block' : 'none';
                } else {
                    vid.srcObject = null;
                    vid.src = v.url;
                    document.getElementById('stop-live-btn').style.display = 'none';
                }

                // INFOS
                document.getElementById('p-title').innerText = v.title;
                document.getElementById('p-author-name').innerText = v.author;
                document.getElementById('p-author-pp').innerHTML = this.getAvatarHTML(v.author, 40);
                document.getElementById('p-views-date').innerText = `${v.views} vues ‚Ä¢ ${this.timeAgo(v.date)}`;
                document.getElementById('p-likes').innerText = v.likes || 0;
                document.getElementById('p-desc').innerText = v.desc || "";

                // GESTION VUES & HISTORIQUE
                v.views++;
                this.addToHistory(v.id);

                // SUGGESTIONS
                const recos = this.data.videos.filter(x => x.id !== id && !x.isShort).slice(0, 5);
                document.getElementById('suggestions-list').innerHTML = recos.map(r => `
                    <div style="display:flex; gap:10px; margin-bottom:10px; cursor:pointer;" onclick="app.openPlayer(${r.id})">
                        <img src="${r.thumb}" style="width:120px; border-radius:6px;">
                        <div>
                            <div style="font-weight:bold; font-size:13px; line-height:1.2;">${r.title}</div>
                            <div style="font-size:12px; color:#aaa;">${r.author}</div>
                        </div>
                    </div>
                `).join('');

                this.renderComments();
                this.updateSubscribeBtnPlayer();
                p.style.display = 'block';
            },

            closePlayer: function() {
                document.getElementById('player-overlay').style.display = 'none';
                const vid = document.getElementById('main-player');
                vid.pause();
                vid.src = "";
                vid.srcObject = null;
            },

            // --- 5. ACTIONS SOCIALES ---
            vote: function(val) {
                if(!this.currentUser) return this.openModal('modal-auth');
                // Logique simplifi√©e : Incr√©mente juste (pour d√©mo)
                if(val > 0) this.activeVideo.likes++;
                document.getElementById('p-likes').innerText = this.activeVideo.likes;
            },

            toggleSubscribe: function() {
                // S'abonner depuis le profil affich√©
                const target = document.getElementById('profile-name').innerText;
                this.doSubscribe(target);
                this.renderProfile(target); // Refresh UI
            },

            toggleSubscribePlayer: function() {
                if(!this.activeVideo) return;
                this.doSubscribe(this.activeVideo.author);
                this.updateSubscribeBtnPlayer();
            },

            doSubscribe: function(targetName) {
                if(!this.currentUser) return this.openModal('modal-auth');
                if(targetName === this.currentUser) return alert("Impossible de s'abonner √† soi-m√™me.");

                const me = this.data.users[this.currentUser];
                const target = this.data.users[targetName];

                if(me.subs.includes(targetName)) {
                    me.subs = me.subs.filter(s => s !== targetName);
                    target.followers = target.followers.filter(f => f !== this.currentUser);
                } else {
                    me.subs.push(targetName);
                    target.followers.push(this.currentUser);
                }
                this.saveData();
                this.renderSubsListSide(); // Update Sidebar
            },

            updateSubscribeBtnPlayer: function() {
                const btn = document.getElementById('p-sub-btn');
                const target = this.activeVideo.author;
                const amSub = this.data.users[this.currentUser]?.subs.includes(target);
                
                btn.innerText = amSub ? "ABONN√â" : "S'ABONNER";
                btn.style.background = amSub ? "#333" : "white";
                btn.style.color = amSub ? "white" : "black";
            },

            postComment: function() {
                if(!this.currentUser) return this.openModal('modal-auth');
                const inp = document.getElementById('com-input');
                const txt = inp.value.trim();
                if(!txt) return;

                if(!this.activeVideo.comments) this.activeVideo.comments = [];
                this.activeVideo.comments.unshift({
                    author: this.currentUser,
                    text: txt,
                    date: Date.now(),
                    likes: 0,
                    heart: false
                });
                inp.value = "";
                this.renderComments();
            },

            renderComments: function() {
                const list = document.getElementById('comments-list');
                const coms = this.activeVideo.comments || [];
                
                list.innerHTML = coms.map((c, idx) => `
                    <div style="display:flex; gap:10px; margin-bottom:15px;">
                        <div style="width:30px; height:30px;">${this.getAvatarHTML(c.author, 30)}</div>
                        <div>
                            <div style="font-size:12px;">
                                <b>${c.author}</b> <span style="color:#aaa;">${this.timeAgo(c.date)}</span>
                            </div>
                            <div style="margin-top:2px;">${c.text}</div>
                            <div style="display:flex; gap:10px; margin-top:5px; align-items:center;">
                                <button style="background:none; border:none; color:#aaa; cursor:pointer;">üëç ${c.likes}</button>
                                ${this.currentUser === this.activeVideo.author ? 
                                    `<button onclick="app.heartComment(${idx})" style="background:none; border:none; cursor:pointer;">‚ù§Ô∏è</button>` : ''}
                                ${c.heart ? '<span style="color:red; font-size:10px;">‚ù§Ô∏è Aim√© par l\'auteur</span>' : ''}
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            heartComment: function(idx) {
                this.activeVideo.comments[idx].heart = !this.activeVideo.comments[idx].heart;
                this.renderComments();
            },

            // --- 6. UPLOAD & LIVE ---
            switchUploadTab: function(tab) {
                document.getElementById('tab-upload').style.display = tab === 'upload' ? 'block' : 'none';
                document.getElementById('tab-live').style.display = tab === 'live' ? 'block' : 'none';
            },

            processUpload: function() {
                if(!this.currentUser) return this.openModal('modal-auth');
                const file = document.getElementById('up-file').files[0];
                const thumb = document.getElementById('up-thumb').files[0];
                const title = document.getElementById('up-title').value;
                const isShort = document.getElementById('up-is-short').checked;

                if(!file || !title) return alert("Vid√©o et titre obligatoires.");

                // CR√âATION URL LOCALE (Fonctionne instantan√©ment)
                const vidUrl = URL.createObjectURL(file);
                const thumbUrl = thumb ? URL.createObjectURL(thumb) : "https://via.placeholder.com/640x360";

                // Cr√©ation objet vid√©o
                const newVid = {
                    id: Date.now(),
                    title: title,
                    desc: document.getElementById('up-desc').value,
                    author: this.currentUser,
                    url: vidUrl,
                    thumb: thumbUrl,
                    views: 0,
                    likes: 0,
                    date: Date.now(),
                    isShort: isShort,
                    duration: "New", // On pourrait calculer la vraie dur√©e avec un √©l√©ment video cach√©e
                    comments: []
                };

                this.data.videos.unshift(newVid);
                alert("Mise en ligne r√©ussie !");
                this.closeModals();
                this.nav('home');
            },

            // LIVE STREAMING
            startCam: async function() {
                try {
                    this.stream = await navigator.mediaDevices.getUserMedia({video:true, audio:true});
                    document.getElementById('live-preview').srcObject = this.stream;
                    document.getElementById('live-preview').muted = true;
                } catch(e) { alert("Erreur cam√©ra : " + e); }
            },
            
            startScreen: async function() {
                try {
                    this.stream = await navigator.mediaDevices.getDisplayMedia({video:true, audio:true});
                    document.getElementById('live-preview').srcObject = this.stream;
                    document.getElementById('live-preview').muted = true;
                } catch(e) { alert("Erreur √©cran : " + e); }
            },

            goLive: function() {
                if(!this.stream) return alert("Aucune source vid√©o (Cam√©ra/√âcran) activ√©e !");
                const title = document.getElementById('live-title').value || "Direct sans titre";
                
                const liveObj = {
                    id: Date.now(),
                    title: "üî¥ " + title,
                    author: this.currentUser,
                    isLive: true,
                    streamObj: this.stream, // On stocke l'objet stream m√©moire
                    thumb: "https://via.placeholder.com/640x360/ff0000/ffffff?text=EN+DIRECT",
                    views: 0,
                    date: Date.now(),
                    isShort: false
                };
                
                this.data.videos.unshift(liveObj);
                alert("Vous √™tes EN DIRECT !");
                this.closeModals();
                this.nav('home');
            },

            stopLive: function() {
                if(this.activeVideo.streamObj) {
                    this.activeVideo.streamObj.getTracks().forEach(track => track.stop());
                }
                // Convertir le live en rediffusion (ou le supprimer)
                this.activeVideo.isLive = false;
                this.activeVideo.title = this.activeVideo.title.replace("üî¥ ", "[Rediff] ");
                this.closePlayer();
                this.nav('home');
            },

            // --- 7. ADMIN & OUTILS ---
            renderAdmin: function() {
                const list = document.getElementById('admin-video-list');
                list.innerHTML = this.data.videos.map(v => `
                    <div style="display:flex; justify-content:space-between; border-bottom:1px solid #333; padding:5px;">
                        <span>${v.title} (${v.author})</span>
                        <button onclick="app.admin.deleteVid(${v.id})" style="color:red; background:none; border:none; cursor:pointer;">Suppr</button>
                    </div>
                `).join('');
            },
            admin: {
                deleteVid: function(id) {
                    if(confirm("Supprimer ?")) {
                        app.data.videos = app.data.videos.filter(v => v.id !== id);
                        app.renderAdmin();
                    }
                },
                postAnnounce: function() {
                    const txt = document.getElementById('admin-announcement').value;
                    app.data.announcements.unshift(txt);
                    alert("Publi√©");
                },
                addThanks: function() {
                    const t = prompt("Nom √† ajouter :");
                    if(t) app.data.thanks.push(t);
                },
                resetAll: function() {
                    if(confirm("RESET TOTAL ?")) {
                        localStorage.clear();
                        location.reload();
                    }
                }
            },

            // --- 8. AUTHENTIFICATION ---
            openModal: function(id) { document.getElementById(id).style.display = 'flex'; },
            closeModals: function() { document.querySelectorAll('.modal-overlay').forEach(el => el.style.display='none'); },

            login: function() {
                const u = document.getElementById('login-user').value.trim();
                if(!u) return;
                
                // Cr√©ation auto
                if(!this.data.users[u]) {
                    this.data.users[u] = { 
                        pp: "", banner: "", bio: "Nouveau membre", 
                        subs: [], followers: [], role: "user", created: Date.now() 
                    };
                }
                
                this.currentUser = u;
                localStorage.setItem('visiona_user', u);
                this.closeModals();
                this.updateUI();
                alert("Bienvenue " + u);
            },
            
            logout: function() {
                localStorage.removeItem('visiona_user');
                location.reload();
            },

            updateUI: function() {
                const authSection = document.getElementById('auth-section');
                const userMenuPP = document.getElementById('dropdown-pp');
                const headerPP = document.getElementById('user-pdp-header'); // Cr√©er dynamiquement

                if(this.currentUser) {
                    const ppHTML = this.getAvatarHTML(this.currentUser, 32);
                    authSection.innerHTML = `<div onclick="document.getElementById('user-dropdown').style.display='block'">${ppHTML}</div>`;
                    userMenuPP.innerHTML = this.getAvatarHTML(this.currentUser, 40);
                    document.getElementById('dropdown-name').innerText = this.currentUser;
                    
                    // Admin check
                    if(this.data.users[this.currentUser]?.role === 'admin' || this.currentUser === "Edonis") {
                        document.getElementById('admin-entry').style.display = 'flex';
                    }
                    this.renderSubsListSide();
                } else {
                    authSection.innerHTML = `<button class="auth-btn" onclick="app.openModal('modal-auth')">CONNEXION</button>`;
                }
            },

            // --- 9. HELPERS / UTILITAIRES ---
            getAvatarHTML: function(username, size=40) {
                const u = this.data.users[username];
                if(u && u.pp) {
                    return `<img src="${u.pp}" style="width:${size}px; height:${size}px; border-radius:50%; object-fit:cover; border:1px solid #333;">`;
                }
                // Avatar par d√©faut : Lettre + Couleur
                const letter = username ? username[0].toUpperCase() : "?";
                const color = this.stringToColor(username || "anon");
                return `<div style="width:${size}px; height:${size}px; border-radius:50%; background:${color}; color:white; display:flex; align-items:center; justify-content:center; font-weight:bold; font-size:${size/2}px;">${letter}</div>`;
            },

            stringToColor: function(str) {
                let hash = 0;
                for (let i = 0; i < str.length; i++) hash = str.charCodeAt(i) + ((hash << 5) - hash);
                let c = (hash & 0x00FFFFFF).toString(16).toUpperCase();
                return "#" + "00000".substring(0, 6 - c.length) + c;
            },

            createCardHTML: function(v) {
                return `
                <div class="video-card" onclick="app.openPlayer(${v.id})">
                    <div class="thumbnail-container">
                        <img src="${v.thumb || 'https://via.placeholder.com/640x360'}" class="thumbnail-img">
                        ${v.isLive ? '<div class="live-badge">DIRECT</div>' : `<div class="duration-badge">${v.duration || "0:00"}</div>`}
                    </div>
                    <div class="video-info">
                        <div class="channel-avatar-small" onclick="event.stopPropagation(); app.renderProfile('${v.author}')">
                            ${this.getAvatarHTML(v.author, 36)}
                        </div>
                        <div style="flex:1">
                            <div class="video-title">${v.title}</div>
                            <div class="video-meta">
                                <span>${v.author}</span>
                                <span>${v.views} vues ‚Ä¢ ${this.timeAgo(v.date)}</span>
                            </div>
                        </div>
                    </div>
                </div>`;
            },

            timeAgo: function(date) {
                const seconds = Math.floor((new Date() - date) / 1000);
                if(seconds < 60) return "√Ä l'instant";
                const m = Math.floor(seconds/60); if(m<60) return m + " min";
                const h = Math.floor(m/60); if(h<24) return h + " h";
                const d = Math.floor(h/24); return d + " j";
            },

            addToHistory: function(id) {
                // Stockage simple en localStorage pour persistance rapide
                let hist = JSON.parse(localStorage.getItem('visiona_hist') || "[]");
                if(!hist.includes(id)) hist.unshift(id);
                localStorage.setItem('visiona_hist', JSON.stringify(hist));
            },

            renderHistory: function() {
                const hist = JSON.parse(localStorage.getItem('visiona_hist') || "[]");
                const vids = hist.map(id => this.data.videos.find(v => v.id === id)).filter(v => v);
                document.getElementById('grid-history').innerHTML = vids.map(v => this.createCardHTML(v)).join('');
            },
            
            clearHistory: function() {
                localStorage.removeItem('visiona_hist');
                this.renderHistory();
            },

            renderSubsListSide: function() {
                const list = document.getElementById('subs-list');
                const subs = this.data.users[this.currentUser]?.subs || [];
                list.innerHTML = subs.map(u => `
                    <div class="nav-item" onclick="app.renderProfile('${u}')" style="padding:5px 12px; gap:10px;">
                        ${this.getAvatarHTML(u, 24)} <span>${u}</span>
                    </div>
                `).join('');
            },
            
            renderThanks: function() {
                document.getElementById('thanks-list').innerHTML = this.data.thanks.map(t => `
                    <div style="background:#1e1e1e; padding:20px; border-radius:10px; border:1px solid var(--accent-gold); text-align:center;">
                        <div style="font-size:20px;">üèÜ</div>
                        <b>${t}</b>
                    </div>
                `).join('');
            },

            addPost: function() {
                const txt = document.getElementById('new-post-txt').value;
                if(txt) {
                    this.data.posts.unshift({ author: this.currentUser, text: txt, date: Date.now() });
                    this.renderCommunity();
                }
            },

            search: function() {
                const q = document.getElementById('search-input').value.toLowerCase();
                const res = this.data.videos.filter(v => v.title.toLowerCase().includes(q) || v.author.toLowerCase().includes(q));
                document.getElementById('grid-home').innerHTML = res.map(v => this.createCardHTML(v)).join('');
                this.nav('home');
            },
            
            easterEgg: function() {
                this.easterEggCount++;
                if(this.easterEggCount === 10) {
                    document.body.classList.add('christmas-mode');
                    alert("üéÑ JOYEUX NO√ãL VISIONA ! üéÑ");
                }
            },

            navToAuthor: function() {
                this.closePlayer();
                this.renderProfile(this.activeVideo.author);
            }
        };

        // Lancement au chargement
        window.onload = function() {
            app.init();
        };
    </script>
</body>
</html>
