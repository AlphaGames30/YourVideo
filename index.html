<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visiona V25 - L'Int√©grale</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #030303; --side: #080808; --card: #121212; --accent: #7c4dff;
            --accent-soft: rgba(124, 77, 255, 0.1); --text: #ffffff; --sec: #909090;
            --border: #1a1a1a; --red: #ff4d4d; --gold: #ffc107;
        }

        * { box-sizing: border-box; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { margin: 0; background: var(--bg); color: var(--text); font-family: 'Plus Jakarta Sans', sans-serif; overflow: hidden; }

        /* --- UI ELEMENTS --- */
        button { cursor: pointer; border: none; font-family: inherit; }
        input, select, textarea { 
            background: #111; border: 1px solid var(--border); color: white; 
            padding: 12px 15px; border-radius: 12px; outline: none; width: 100%;
        }
        input:focus { border-color: var(--accent); box-shadow: 0 0 10px var(--accent-soft); }

        /* --- HEADER --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            height: 75px; padding: 0 30px; background: rgba(3,3,3,0.8);
            backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 1000;
            border-bottom: 1px solid var(--border);
        }
        .logo { display: flex; align-items: center; gap: 12px; font-weight: 800; font-size: 22px; letter-spacing: -0.5px; }
        .logo-box { 
            width: 38px; height: 38px; background: linear-gradient(135deg, var(--accent), #00d2ff); 
            border-radius: 10px; display: flex; align-items: center; justify-content: center;
            color: white; transform: rotate(-5deg); box-shadow: 0 5px 15px rgba(124, 77, 255, 0.4);
        }

        .search-bar {
            flex: 1; max-width: 550px; display: flex; margin: 0 40px;
            background: #000; border: 1px solid var(--border); border-radius: 30px; padding: 4px 6px;
        }
        .search-bar input { background: transparent; border: none; padding: 8px 15px; }
        .search-bar button { background: var(--accent); color: white; padding: 0 20px; border-radius: 25px; font-weight: 600; }

        /* --- MAIN LAYOUT --- */
        .wrapper { display: flex; height: calc(100vh - 75px); }
        
        .sidebar {
            width: 260px; background: var(--side); padding: 20px;
            overflow-y: auto; border-right: 1px solid var(--border); flex-shrink: 0;
        }

        .content { flex: 1; padding: 30px; overflow-y: auto; position: relative; scroll-behavior: smooth; }

        /* --- NAVIGATION --- */
        .nav-item {
            display: flex; align-items: center; gap: 15px; padding: 12px 15px;
            border-radius: 12px; color: var(--sec); margin-bottom: 4px; font-weight: 500;
        }
        .nav-item:hover, .nav-item.active { background: var(--card); color: white; }
        .nav-item.active { color: var(--accent); font-weight: 700; background: var(--accent-soft); }
        .nav-sep { height: 1px; background: var(--border); margin: 20px 0; }
        .nav-label { font-size: 11px; color: var(--sec); font-weight: 800; margin: 0 0 10px 15px; text-transform: uppercase; }

        /* --- GRIDS & CARDS --- */
        .v-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 25px; }
        @media (max-width: 1400px) { .v-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 1000px) { .v-grid { grid-template-columns: repeat(2, 1fr); } }

        .v-card { cursor: pointer; }
        .v-card:hover .v-thumb img { transform: scale(1.05); }
        .v-thumb {
            width: 100%; aspect-ratio: 16/9; border-radius: 18px; overflow: hidden;
            background: #111; position: relative; border: 1px solid var(--border);
        }
        .v-thumb img { width: 100%; height: 100%; object-fit: cover; }
        .v-badge { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.8); padding: 4px 8px; border-radius: 6px; font-size: 11px; font-weight: 600; }
        .live-tag { position: absolute; top: 10px; left: 10px; background: var(--red); color: white; padding: 3px 8px; border-radius: 4px; font-size: 10px; font-weight: 800; animation: pulse 1.5s infinite; }

        .v-meta { display: flex; gap: 12px; margin-top: 15px; }
        .v-pdp { width: 40px; height: 40px; border-radius: 50%; object-fit: cover; background: #333; flex-shrink: 0; }
        .v-details h4 { margin: 0 0 5px 0; font-size: 15px; line-height: 1.4; display: -webkit-box; -webkit-line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden; }
        .v-details p { margin: 0; font-size: 13px; color: var(--sec); }

        /* --- ZAPPS SYSTEM --- */
        #view-zapps { height: 100%; display: none; flex-direction: column; align-items: center; overflow-y: scroll; scroll-snap-type: y mandatory; }
        .zapp-container {
            width: 400px; height: calc(100vh - 100px); background: #000;
            scroll-snap-align: start; margin-bottom: 20px; border-radius: 20px;
            position: relative; overflow: hidden;
        }
        .zapp-video { width: 100%; height: 100%; object-fit: cover; }
        .zapp-ui { position: absolute; bottom: 0; left: 0; right: 0; padding: 25px; background: linear-gradient(transparent, rgba(0,0,0,0.9)); }
        .zapp-actions { position: absolute; right: 15px; bottom: 100px; display: flex; flex-direction: column; gap: 20px; }
        .zapp-btn { background: rgba(255,255,255,0.1); width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(10px); font-size: 20px; }

        /* --- PLAYER --- */
        #player-view { display: none; position: fixed; inset: 0; background: var(--bg); z-index: 2000; overflow-y: auto; padding-bottom: 100px; }
        .p-container { max-width: 1200px; margin: 0 auto; padding: 25px; }
        .p-stage { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 25px; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .p-author-box { display: flex; justify-content: space-between; align-items: center; background: var(--card); padding: 20px; border-radius: 20px; margin-top: 25px; border: 1px solid var(--border); }

        /* --- MODALS --- */
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9); backdrop-filter: blur(10px); z-index: 5000; align-items: center; justify-content: center; }
        .modal-card { background: var(--side); width: 90%; max-width: 500px; padding: 35px; border-radius: 30px; border: 1px solid var(--border); }
        .btn-prime { background: var(--accent); color: white; padding: 15px; border-radius: 12px; font-weight: 700; font-size: 15px; width: 100%; margin-top: 10px; }
        .btn-ghost { background: transparent; color: var(--sec); padding: 10px; font-weight: 600; width: 100%; }

        /* --- POSTS --- */
        .post-card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 25px; margin-bottom: 25px; }
        .post-img { width: 100%; border-radius: 15px; margin-top: 15px; max-height: 400px; object-fit: cover; }

        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }
    </style>
</head>
<body>

    <header>
        <div class="logo" onclick="app.nav('home')">
            <div class="logo-box">V</div> VISIONA
        </div>
        <div class="search-bar">
            <input type="text" id="mainSearch" placeholder="Rechercher une vid√©o, un zapp, un cr√©ateur...">
            <button onclick="app.search()">üîç</button>
        </div>
        <div id="userHeader" style="display:flex; align-items:center; gap:20px;"></div>
    </header>

    <div class="wrapper">
        <aside class="sidebar">
            <div class="nav-item active" id="m-home" onclick="app.nav('home')">üè† Accueil</div>
            <div class="nav-item" id="m-zapps" onclick="app.nav('zapps')">‚ö° Visiona Zapps</div>
            <div class="nav-item" id="m-lives" onclick="app.nav('lives')">üî¥ En Direct</div>
            <div class="nav-sep"></div>
            <div class="nav-label">Biblioth√®que</div>
            <div class="nav-item" onclick="app.nav('history')">üïí Historique</div>
            <div class="nav-item" onclick="app.nav('community')">üì∞ Communaut√©</div>
            <div class="nav-item" onclick="app.nav('stats')">üìä Statistiques</div>
            <div class="nav-sep"></div>
            <div class="nav-label">Abonnements</div>
            <div id="sideSubs"></div>
        </aside>

        <main class="content">
            <div id="view-home">
                <h2 style="margin-bottom:25px; font-weight:800;">Recommandations</h2>
                <div id="grid-home" class="v-grid"></div>
            </div>

            <div id="view-zapps"></div>

            <div id="view-profile" style="display:none;"></div>

            <div id="view-alt" style="display:none;"></div>
        </main>
    </div>

    <div id="player-view">
        <div class="p-container">
            <button class="btn-ghost" style="text-align:left; width:auto;" onclick="app.closePlayer()">‚Üê RETOUR</button>
            <div class="p-stage">
                <video id="v-player" controls autoplay style="width:100%; height:100%;"></video>
                <canvas id="s-canvas" style="display:none; width:100%; height:100%;"></canvas>
            </div>
            <div style="margin-top:25px;">
                <h1 id="p-title" style="font-size:24px; font-weight:800; margin:0;"></h1>
                <p id="p-views" style="color:var(--sec); margin-top:5px;"></p>
                <div class="p-author-box">
                    <div id="p-author-details" style="display:flex; align-items:center; gap:15px; cursor:pointer;"></div>
                    <button class="btn-prime" id="btnSub" style="width:auto; padding:12px 25px;"></button>
                </div>

                <div style="margin-top:40px;">
                    <h3>Commentaires (<span id="p-com-count">0</span>)</h3>
                    <div style="display:flex; gap:15px; margin-bottom:30px;">
                        <input type="text" id="comInput" placeholder="Ajouter un commentaire..." style="margin:0;">
                        <button class="btn-prime" style="width:140px; margin:0;" onclick="app.addComment()">Publier</button>
                    </div>
                    <div id="p-comments"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="modalAuth" class="modal">
        <div class="modal-card">
            <h2 style="margin-top:0;">Bienvenue sur Visiona</h2>
            <p style="color:var(--sec); font-size:14px; margin-bottom:25px;">Connectez-vous pour publier, commenter et vous abonner.</p>
            <input type="text" id="authName" placeholder="Pseudo">
            <input type="password" id="authPass" placeholder="Mot de passe (fictif)">
            <button class="btn-prime" onclick="app.login()">SE CONNECTER</button>
            <button class="btn-ghost" onclick="app.closeModals()">Continuer en invit√©</button>
        </div>
    </div>

    <div id="modalUp" class="modal">
        <div class="modal-card">
            <h2 style="margin:0;">Cr√©er du contenu</h2>
            <select id="upType" onchange="app.uiUpToggle()" style="margin-top:20px;">
                <option value="video">üé• Vid√©o Classique</option>
                <option value="zapp">‚ö° Zapp (Court)</option>
                <option value="post">üì∞ Publication Image/Texte</option>
                <option value="live">üî¥ Lancer un Direct</option>
            </select>
            <input type="text" id="upTitle" placeholder="Titre ou message">
            <div id="upFileGroup">
                <p style="font-size:11px; color:var(--sec); margin:15px 0 5px 0;">FICHIER PRINCIPAL (MP4/JPG) :</p>
                <input type="file" id="upMainFile">
                <p style="font-size:11px; color:var(--sec); margin:15px 0 5px 0;">MINIATURE (OPTIONNEL) :</p>
                <input type="file" id="upThumbFile">
            </div>
            <div id="upStatus" style="color:var(--accent); font-weight:700; margin-top:15px; font-size:13px; text-align:center;"></div>
            <button class="btn-prime" id="btnUpSubmit" onclick="app.publish()">PUBLIER</button>
            <button class="btn-ghost" onclick="app.closeModals()">Annuler</button>
        </div>
    </div>

    <script>
        const DB_URL = "https://gist.githubusercontent.com/AlphaGames30/5248424f9cc79feb78c0560faad87c92/raw/video.json";
        const WRK_URL = "https://mytubeupload.edonis-imbert.workers.dev/";
        const CLD_URL = "https://api.cloudinary.com/v1_1/dvbsmh8qq/upload";
        
        const app = {
            data: {
                user: JSON.parse(localStorage.getItem('v_user')),
                vids: [], users: {}, posts: [],
                subs: JSON.parse(localStorage.getItem('v_subs')) || [],
                hist: JSON.parse(localStorage.getItem('v_hist')) || [],
                views: JSON.parse(localStorage.getItem('v_views')) || {}
            },
            active: null,

            init: async function() {
                await this.sync();
                this.renderUI();
                this.nav('home');
            },

            sync: async function() {
                try {
                    const r = await fetch(DB_URL + "?t=" + Date.now());
                    const j = await r.json();
                    this.data.vids = j.videos || [];
                    this.data.users = j.users || {};
                    this.data.posts = j.posts || [];
                } catch(e) { console.error("Sync Error", e); }
            },

            save: async function() {
                const b = { videos: this.data.vids, users: this.data.users, posts: this.data.posts };
                await fetch(WRK_URL, {
                    method: 'PATCH',
                    body: JSON.stringify({ files: {"video.json": {content: JSON.stringify(b, null, 2)}}})
                });
            },

            // --- NAVIGATION ---
            nav: function(page) {
                const sections = ['view-home', 'view-zapps', 'view-profile', 'view-alt'];
                sections.forEach(s => document.getElementById(s).style.display = 'none');
                document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));

                if(page === 'home') {
                    document.getElementById('view-home').style.display = 'block';
                    document.getElementById('m-home').classList.add('active');
                    this.renderHome();
                } else if(page === 'zapps') {
                    document.getElementById('view-zapps').style.display = 'flex';
                    document.getElementById('m-zapps').classList.add('active');
                    this.renderZapps();
                } else if(page === 'community') {
                    this.renderCommunity();
                }
            },

            // --- RENDU ACCUEIL ---
            renderHome: function() {
                const grid = document.getElementById('grid-home');
                let pool = [...this.data.vids.filter(v => !v.isShort && !v.isStream)];
                pool.sort(() => Math.random() - 0.5); // Al√©atoire complet
                grid.innerHTML = pool.map(v => this.tplCard(v)).join('');
            },

            tplCard: function(v) {
                return `
                    <div class="v-card" onclick="app.openPlayer('${v.id}')">
                        <div class="v-thumb">
                            <img src="${v.thumb || 'https://via.placeholder.com/400x225/111/fff?text=Visiona'}">
                            ${v.isStream ? '<div class="live-tag">DIRECT</div>' : ''}
                            <div class="v-badge">${v.duration || '10:00'}</div>
                        </div>
                        <div class="v-meta">
                            <img src="${this.getPDP(v.author)}" class="v-pdp" onclick="event.stopPropagation(); app.goProfile('${v.author}')">
                            <div class="v-details">
                                <h4>${v.title}</h4>
                                <p>${v.author} ‚Ä¢ ${v.views || 0} vues ‚Ä¢ ${this.timeAgo(v.timestamp)}</p>
                            </div>
                        </div>
                    </div>
                `;
            },

            // --- ZAPPS (TikTok Style) ---
            renderZapps: function() {
                const container = document.getElementById('view-zapps');
                const zapps = this.data.vids.filter(v => v.isShort);
                container.innerHTML = zapps.map(z => `
                    <div class="zapp-container">
                        <video src="${z.url}" class="zapp-video" loop autoplay muted onclick="this.paused ? this.play() : this.pause()"></video>
                        <div class="zapp-actions">
                            <div class="zapp-btn">‚ù§Ô∏è</div>
                            <div class="zapp-btn">üí¨</div>
                            <div class="zapp-btn">üîÅ</div>
                        </div>
                        <div class="zapp-ui">
                            <div style="display:flex; align-items:center; gap:12px; margin-bottom:10px;">
                                <img src="${this.getPDP(z.author)}" style="width:35px; height:35px; border-radius:50%;">
                                <b>@${z.author}</b>
                                <button style="background:var(--accent); color:white; font-size:10px; padding:4px 10px; border-radius:15px;">SUIVRE</button>
                            </div>
                            <p style="margin:0; font-size:14px;">${z.title}</p>
                        </div>
                    </div>
                `).join('');
            },

            // --- COMMUNAUT√â (Posts avec Images) ---
            renderCommunity: function() {
                const view = document.getElementById('view-alt');
                view.style.display = 'block';
                view.innerHTML = `<h2 style="margin-bottom:30px;">Fil Communautaire</h2>`;
                view.innerHTML += this.data.posts.map(p => `
                    <div class="post-card">
                        <div style="display:flex; align-items:center; gap:15px; margin-bottom:15px;">
                            <img src="${this.getPDP(p.author)}" style="width:45px; height:45px; border-radius:50%;">
                            <div>
                                <b style="display:block;">${p.author}</b>
                                <span style="font-size:12px; color:var(--sec);">${this.timeAgo(p.timestamp)}</span>
                            </div>
                        </div>
                        <p style="font-size:16px; line-height:1.6;">${p.text}</p>
                        ${p.image ? `<img src="${p.image}" class="post-img">` : ''}
                        <div style="margin-top:20px; border-top:1px solid var(--border); padding-top:15px; color:var(--sec); font-size:13px;">
                            üí¨ ${p.comments?.length || 0} Commentaires ‚Ä¢ ‚ù§Ô∏è J'aime
                        </div>
                    </div>
                `).join('');
            },

            // --- LECTEUR & VUES ---
            openPlayer: function(id) {
                const v = this.data.vids.find(x => x.id == id);
                this.active = v;
                
                // Logic Vues (Cooldown 1h)
                const now = Date.now();
                if(!this.data.views[id] || (now - this.data.views[id] > 3600000)) {
                    v.views = (v.views || 0) + 1;
                    this.data.views[id] = now;
                    localStorage.setItem('v_views', JSON.stringify(this.data.views));
                    this.save();
                }

                document.getElementById('player-view').style.display = 'block';
                document.getElementById('p-title').innerText = v.title;
                document.getElementById('p-views').innerText = `${v.views} vues ‚Ä¢ ${this.timeAgo(v.timestamp)}`;
                document.getElementById('v-player').src = v.url;

                this.renderPlayerAuthor();
                this.renderComments();
            },

            renderPlayerAuthor: function() {
                const sub = this.data.subs.find(s => s.name === this.active.author);
                document.getElementById('p-author-details').innerHTML = `
                    <img src="${this.getPDP(this.active.author)}" style="width:50px; height:50px; border-radius:50%;">
                    <div>
                        <b style="font-size:17px; display:block;">${this.active.author}</b>
                        <span style="font-size:12px; color:var(--sec);">124k abonn√©s</span>
                    </div>
                `;
                const btn = document.getElementById('btnSub');
                btn.innerText = sub ? "ABONN√â ‚úÖ" : "S'ABONNER";
                btn.style.background = sub ? "#222" : "var(--accent)";
                btn.onclick = () => this.toggleSub(this.active.author);
            },

            renderComments: function() {
                const box = document.getElementById('p-comments');
                const coms = this.active.comments || [];
                document.getElementById('p-com-count').innerText = coms.length;
                box.innerHTML = coms.map(c => `
                    <div style="display:flex; gap:15px; margin-bottom:20px;">
                        <img src="${this.getPDP(c.author)}" style="width:35px; height:35px; border-radius:50%;">
                        <div>
                            <b style="font-size:13px;">${c.author} ‚Ä¢ <span style="font-weight:400; color:var(--sec);">${this.timeAgo(c.timestamp)}</span></b>
                            <p style="margin:5px 0 0 0; font-size:14px;">${c.text}</p>
                        </div>
                    </div>
                `).join('');
            },

            addComment: async function() {
                if(!this.data.user) return this.openModal('modalAuth');
                const txt = document.getElementById('comInput').value;
                if(!txt) return;

                if(!this.active.comments) this.active.comments = [];
                this.active.comments.unshift({
                    author: this.data.user.name,
                    text: txt,
                    timestamp: Date.now()
                });
                document.getElementById('comInput').value = "";
                this.renderComments();
                this.save();
            },

            // --- PUBLICATION (Cloudinary) ---
            publish: async function() {
                if(!this.data.user) return this.openModal('modalAuth');
                const type = document.getElementById('upType').value;
                const title = document.getElementById('upTitle').value;
                const file = document.getElementById('upMainFile').files[0];
                const btn = document.getElementById('btnUpSubmit');
                const log = document.getElementById('upStatus');

                if(!title || (type !== 'post' && !file)) return alert("Champs manquants");

                btn.disabled = true; log.innerText = "‚è≥ Upload vers Visiona Cloud...";

                try {
                    let mainUrl = "", thumbUrl = "";
                    if(file) mainUrl = await this.uploadCloud(file, file.type.includes('video') ? 'video' : 'image');
                    
                    if(type === 'post') {
                        this.data.posts.unshift({
                            author: this.data.user.name,
                            text: title,
                            image: mainUrl,
                            timestamp: Date.now(),
                            comments: []
                        });
                    } else {
                        this.data.vids.unshift({
                            id: Date.now(),
                            title: title,
                            author: this.data.user.name,
                            url: mainUrl,
                            thumb: type === 'zapp' ? mainUrl.replace('.mp4', '.jpg') : 'https://via.placeholder.com/800x450',
                            isShort: type === 'zapp',
                            isStream: type === 'live',
                            views: 0,
                            timestamp: Date.now(),
                            comments: []
                        });
                    }

                    await this.save();
                    location.reload();
                } catch(e) { 
                    alert("Erreur upload"); btn.disabled = false; log.innerText = "";
                }
            },

            uploadCloud: async function(file, rType) {
                const fd = new FormData(); fd.append('file', file); fd.append('upload_preset', 'mytube_upload');
                const r = await fetch(CLD_URL.replace('upload', rType+'/upload'), { method: 'POST', body: fd });
                const j = await r.json(); return j.secure_url;
            },

            // --- AUTH & UI ---
            login: function() {
                const name = document.getElementById('authName').value;
                if(!name) return;
                this.data.user = { name: name, email: name.toLowerCase() + "@visiona.com" };
                localStorage.setItem('v_user', JSON.stringify(this.data.user));
                location.reload();
            },

            logout: function() {
                localStorage.removeItem('v_user');
                location.reload();
            },

            renderUI: function() {
                const h = document.getElementById('userHeader');
                if(this.data.user) {
                    h.innerHTML = `
                        <button onclick="app.openModal('modalUp')" style="background:var(--accent); color:white; padding:8px 18px; border-radius:20px; font-weight:700;">PUBLIER</button>
                        <div style="position:relative; cursor:pointer;" onclick="this.querySelector('.drop').style.display='block'">
                            <img src="${this.getPDP(this.data.user.name)}" style="width:40px; height:40px; border-radius:50%;">
                            <div class="drop" style="display:none; position:absolute; top:50px; right:0; background:var(--card); border:1px solid var(--border); border-radius:10px; width:150px; z-index:100;">
                                <div style="padding:10px; border-bottom:1px solid var(--border); font-size:12px;">@${this.data.user.name}</div>
                                <div onclick="app.logout()" style="padding:10px; color:var(--red); font-size:14px; font-weight:700;">D√©connexion</div>
                            </div>
                        </div>
                    `;
                } else {
                    h.innerHTML = `<button class="btn-prime" style="width:auto; padding:8px 20px;" onclick="app.openModal('modalAuth')">Se connecter</button>`;
                }

                document.getElementById('sideSubs').innerHTML = this.data.subs.map(s => `
                    <div class="nav-item" onclick="app.goProfile('${s.name}')">
                        <img src="${this.getPDP(s.name)}" style="width:24px; height:24px; border-radius:50%;">
                        <span>${s.name}</span>
                    </div>
                `).join('');
            },

            // --- HELPERS ---
            getPDP: function(n) { return `https://ui-avatars.com/api/?name=${n}&background=7c4dff&color=fff`; },
            
            timeAgo: function(ts) {
                if(!ts) return "Il y a longtemps";
                const diff = Math.floor((Date.now() - ts) / 1000);
                if(diff < 60) return `Il y a ${diff}s`;
                if(diff < 3600) return `Il y a ${Math.floor(diff/60)}m`;
                if(diff < 86400) return `Il y a ${Math.floor(diff/3600)}h`;
                return `Il y a ${Math.floor(diff/86400)}j`;
            },

            toggleSub: function(name) {
                if(!this.data.user) return this.openModal('modalAuth');
                const idx = this.data.subs.findIndex(s => s.name === name);
                if(idx > -1) this.data.subs.splice(idx, 1);
                else this.data.subs.push({name: name, tier: 'Standard'});
                localStorage.setItem('v_subs', JSON.stringify(this.data.subs));
                this.renderUI();
                this.renderPlayerAuthor();
            },

            openModal: function(id) { document.getElementById(id).style.display = 'flex'; },
            closeModals: function() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); },
            closePlayer: function() { document.getElementById('player-view').style.display = 'none'; document.getElementById('v-player').pause(); },
            uiUpToggle: function() {
                const t = document.getElementById('upType').value;
                document.getElementById('upFileGroup').style.display = (t === 'live') ? 'none' : 'block';
            }
        };

        app.init();
    </script>
</body>
</html>
