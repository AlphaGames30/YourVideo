<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Visiona V16 Ultimate - AlphaGames30 & Edonis</title>
    <style>
        :root { 
            --bg: #0f0f0f; --header: #0f0f0f; --text: #ffffff; --sec-text: #aaaaaa; 
            --hover: #272727; --blue: #3ea6ff; --red: #ff0000; --gold: #ffd700; --xmas: #d42426;
        }

        body { margin: 0; background: var(--bg); color: var(--text); font-family: Roboto, Arial, sans-serif; overflow-x: hidden; padding-bottom: 60px; transition: filter 0.5s; }
        body.xmas-theme { --bg: #050f06; }

        /* --- EFFETS --- */
        #snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
        .snowflake { position: fixed; top: -10px; color: white; font-size: 1.2em; user-select: none; z-index: 9999; animation: fall linear infinite; }
        @keyframes fall { to { transform: translateY(105vh) rotate(360deg); } }

        /* --- HEADER --- */
        header { display: flex; justify-content: space-between; align-items: center; padding: 0 16px; height: 56px; background: var(--header); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid #222; }
        .logo { font-size: 20px; font-weight: bold; cursor: pointer; display: flex; align-items: center; gap: 8px; }
        .logo-icon { font-size: 24px; }
        
        .search-box { display: flex; flex: 1; max-width: 600px; margin: 0 20px; }
        .search-box input { width: 100%; background: #121212; border: 1px solid #333; color: white; padding: 10px 15px; border-radius: 40px 0 0 40px; outline: none; }
        .search-box button { background: #222; border: 1px solid #333; border-left: none; padding: 0 20px; border-radius: 0 40px 40px 0; cursor: pointer; color: white; }

        /* --- LAYOUT --- */
        .container { display: flex; height: calc(100vh - 56px); }
        .sidebar { width: 240px; background: var(--bg); padding: 12px; overflow-y: auto; flex-shrink: 0; border-right: 1px solid #222; }
        .nav-item { padding: 12px; border-radius: 10px; cursor: pointer; margin-bottom: 4px; display: flex; align-items: center; gap: 15px; transition: 0.2s; font-size: 14px; }
        .nav-item:hover { background: var(--hover); }
        .nav-active { background: var(--hover); font-weight: bold; border-left: 4px solid var(--red); }
        .sidebar hr { border: none; border-top: 1px solid #333; margin: 12px 0; }

        .content { flex: 1; padding: 24px; overflow-y: auto; }
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 20px; }
        
        /* --- AVATARS --- */
        .avatar-letter { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; color: white; background: var(--xmas); flex-shrink: 0; }
        .avatar-img { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
        .avatar-sidebar { width: 24px; height: 24px; font-size: 12px; }

        /* --- PLAYER & COMMENTS --- */
        .player-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 1000; overflow-y: auto; }
        .video-wrapper { width: 100%; max-width: 1200px; margin: 0 auto; aspect-ratio: 16/9; background: #000; position: relative; }
        #liveCanvas { width: 100%; height: 100%; display: none; }
        
        .comment-item { display: flex; gap: 12px; margin: 20px 0; position: relative; }
        .heart-badge { display: flex; align-items: center; gap: 4px; background: #272727; padding: 2px 6px; border-radius: 10px; font-size: 11px; margin-top: 5px; width: fit-content; }
        .heart-badge img { width: 14px; height: 14px; border-radius: 50%; }

        /* --- MODALS --- */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 2000; justify-content: center; align-items: center; }
        .modal-box { background: #212121; padding: 25px; border-radius: 15px; width: 90%; max-width: 500px; border: 1px solid #333; }
        .modal-box input, .modal-box textarea { width: 100%; padding: 12px; margin: 10px 0; background: #121212; border: 1px solid #444; color: white; border-radius: 8px; box-sizing: border-box; }

        .btn-blue { background: var(--blue); color: #000; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .btn-red { background: var(--red); color: #fff; border: none; padding: 10px 20px; border-radius: 20px; font-weight: bold; cursor: pointer; }
        .action-pill { background: #272727; color: white; border: none; padding: 8px 16px; border-radius: 20px; cursor: pointer; font-size: 14px; }

        #accountMenu { display: none; position: fixed; right: 20px; top: 60px; background: #282828; border: 1px solid #444; border-radius: 12px; z-index: 1500; min-width: 200px; }
        #santaToast { position: fixed; bottom: 20px; right: 20px; background: var(--xmas); color: white; padding: 15px; border-radius: 10px; display: none; z-index: 3000; box-shadow: 0 0 20px rgba(255,0,0,0.5); }

        footer { text-align: center; padding: 40px; color: var(--sec-text); border-top: 1px solid #222; margin-top: 50px; }
    </style>
</head>
<body>

    <div id="snow-container"></div>
    <div id="santaToast">üéÖ Ho Ho Ho ! Merci pour l'abonnement !</div>

    <header>
        <div class="logo" onclick="app.goHome()">
            <span class="logo-icon">üéÖ</span>
            <span>Visiona</span>
        </div>
        <div class="search-box">
            <input type="text" id="searchInp" placeholder="Rechercher...">
            <button onclick="app.search()">üîç</button>
        </div>
        <div id="authArea" style="display:flex; align-items:center;"></div>
    </header>

    <div id="accountMenu">
        <div id="menuUser" style="padding:15px; border-bottom:1px solid #444; font-weight:bold; color:var(--blue);"></div>
        <div class="nav-item" onclick="app.goMyProfile()">üë§ Ma Cha√Æne</div>
        <div class="nav-item" onclick="app.doLogout()" style="color:var(--red);">üö™ D√©connexion</div>
    </div>

    <div class="container">
        <nav class="sidebar">
            <div class="nav-item nav-active" id="navHome" onclick="app.goHome()">üè† Accueil</div>
            <div class="nav-item" id="navShorts" onclick="app.goShorts()">‚ö° Zapp</div>
            <div class="nav-item" id="navStreams" onclick="app.goStreams()">üî¥ Streams</div>
            <div class="nav-item" id="navPosts" onclick="app.goCommunity()">üì∞ Publications</div>
            <hr>
            <div class="nav-item" id="navHistory" onclick="app.goHistory()">üïí Historique</div>
            <div class="nav-item" id="navStats" onclick="app.goStats()">üìä Statistiques</div>
            <div class="nav-item" onclick="app.goMyProfile()">üë§ Ma Cha√Æne</div>
            <hr>
            <div style="font-size:12px; color:var(--sec-text); padding-left:10px; margin-bottom:10px;">ABONNEMENTS</div>
            <div id="sidebarSubs"></div>
            <hr>
            <div id="adminLink" class="nav-item" style="display:none; color:var(--red);" onclick="app.goAdmin()">üîë Admin Panel</div>
        </nav>

        <main class="content">
            <div id="viewTitle"></div>
            
            <div id="mainGrid" class="video-grid"></div>
            <div id="communityView" style="display:none;"></div>

            <div id="statsView" style="display:none;">
                <h2>üìä Statistiques de ta cha√Æne</h2>
                <div id="statsBox" style="display:grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap:15px;">
                    </div>
            </div>

            <div id="profileView" style="display:none;">
                <img id="pBanner" src="" style="width:100%; height:200px; object-fit:cover; border-radius:15px; background:#333;">
                <div style="display:flex; align-items:center; gap:20px; margin-top:-50px; padding:0 30px;">
                    <div id="pAvatarLarge"></div>
                    <div style="margin-top:40px;">
                        <h1 id="pName" style="margin:0;"></h1>
                        <p id="pSubCount" style="color:var(--sec-text);"></p>
                        <div id="pActions"></div>
                    </div>
                </div>
                <div id="pVideos" class="video-grid" style="margin-top:30px; border-top:1px solid #333; padding-top:20px;"></div>
            </div>

            <div id="adminPanel" style="display:none;">
                <h2>üîë Administration</h2>
                <div style="display:flex; gap:10px; margin-bottom:20px;">
                    <button class="btn-blue" onclick="app.openBroadcast()">üì¢ Nouvelle Annonce</button>
                    <button class="action-pill" onclick="app.editCredits()">üìù Modifier Cr√©dits</button>
                </div>
                <div id="adminList"></div>
            </div>

            <footer id="footerCredits">
                <p>¬© 2024 Visiona - AlphaGames30 & Edonis Imbert</p>
                <div id="dynamicCredits"></div>
            </footer>
        </main>
    </div>

    <div id="playerModal" class="player-overlay">
        <div style="padding:15px;"><button class="action-pill" onclick="app.closePlayer()">‚úï FERMER</button></div>
        <div class="video-wrapper">
            <video id="playerVid" controls autoplay style="width:100%; height:100%;"></video>
            <canvas id="liveCanvas"></canvas>
        </div>
        <div style="max-width:1200px; margin:0 auto; padding:20px;">
            <h2 id="vidTitle"></h2>
            <div id="vidInfo" style="display:flex; justify-content:space-between; align-items:center;"></div>
            <div id="commentSection" style="margin-top:40px;">
                <h3>Commentaires</h3>
                <div style="display:flex; gap:10px;">
                    <input type="text" id="comInp" placeholder="Ajouter un commentaire public...">
                    <button class="btn-blue" onclick="app.addComment()">Publier</button>
                </div>
                <div id="comList"></div>
            </div>
        </div>
    </div>

    <div id="modalCreate" class="modal">
        <div class="modal-box">
            <h2>Cr√©er</h2>
            <button class="btn-blue" style="width:100%; margin-bottom:10px;" onclick="app.openUpload('video')">üé¨ Vid√©o / Zapp</button>
            <button class="btn-red" style="width:100%; margin-bottom:10px;" onclick="app.openStreamModal()">üî¥ Lancer un Stream</button>
            <button class="btn-blue" style="width:100%; background:#444;" onclick="app.openPostModal()">üì∞ Publication</button>
            <button class="action-pill" style="width:100%; margin-top:20px;" onclick="app.closeModals()">Annuler</button>
        </div>
    </div>

    <div id="modalStreamSetup" class="modal">
        <div class="modal-box">
            <h2>Configuration du Stream</h2>
            <input type="text" id="stTitle" placeholder="Titre du stream">
            <label>Miniature du Stream :</label>
            <input type="file" id="stThumb" accept="image/*">
            <button class="btn-red" style="width:100%;" onclick="app.startRealStream()">LANCER LE DIRECT</button>
            <button class="action-pill" style="width:100%; margin-top:10px;" onclick="app.closeModals()">Annuler</button>
        </div>
    </div>

    <script>
        const CLOUDINARY_URL = "https://api.cloudinary.com/v1_1/dvbsmh8qq/upload";
        const GIST_URL = "https://gist.githubusercontent.com/AlphaGames30/5248424f9cc79feb78c0560faad87c92/raw/video.json";
        const WORKER_URL = "https://mytubeupload.edonis-imbert.workers.dev/";
        const ADMIN_EMAIL = "edonis.imbert@gmail.com";
        const streamBus = new BroadcastChannel('visiona_live_v16');

        const app = {
            data: {
                user: JSON.parse(localStorage.getItem('mt_user')),
                videos: [], users: {}, posts: [], credits: "",
                subs: JSON.parse(localStorage.getItem('mt_subs')) || [],
                history: JSON.parse(localStorage.getItem('mt_history')) || [],
                stats: JSON.parse(localStorage.getItem('mt_stats')) || { time: 0, likes: 0, views: 0 }
            },
            activeVid: null,
            localStream: null,

            init: async function() {
                this.checkXmas();
                await this.loadData();
                this.updateUI();
                this.goHome();
                this.listenToStreams();
                setInterval(() => { this.data.stats.time += 1; localStorage.setItem('mt_stats', JSON.stringify(this.data.stats)); }, 1000);
            },

            checkXmas: function() {
                if(Math.random() < 0.001) {
                    document.body.classList.add('xmas-theme');
                    const c = document.getElementById('snow-container');
                    for(let i=0; i<60; i++) {
                        let s = document.createElement('div');
                        s.className = 'snowflake'; s.innerHTML = '‚ùÑ';
                        s.style.left = Math.random()*100+'vw';
                        s.style.animationDuration = (Math.random()*3+2)+'s';
                        c.appendChild(s);
                    }
                }
            },

            loadData: async function() {
                try {
                    const res = await fetch(GIST_URL + "?t=" + Date.now());
                    const json = await res.json();
                    this.data.videos = json.videos || [];
                    this.data.users = json.users || {};
                    this.data.posts = json.posts || [];
                    this.data.credits = json.credits || "√âquipe Visiona";
                    document.getElementById('dynamicCredits').innerText = this.data.credits;
                } catch(e) { console.error(e); }
            },

            save: async function() {
                const content = { videos: this.data.videos, users: this.data.users, posts: this.data.posts, credits: this.data.credits };
                await fetch(WORKER_URL, { method: 'PATCH', body: JSON.stringify({ files: {"video.json": {content: JSON.stringify(content, null, 2)}}}) });
            },

            // --- NAVIGATION ---
            hideAll: function() {
                ['mainGrid', 'communityView', 'statsView', 'profileView', 'adminPanel'].forEach(id => document.getElementById(id).style.display = 'none');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('nav-active'));
                document.getElementById('accountMenu').style.display = 'none';
            },

            goHome: function() {
                this.hideAll();
                document.getElementById('navHome').classList.add('nav-active');
                document.getElementById('mainGrid').style.display = 'grid';
                this.renderVids(this.data.videos.filter(v => !v.isShort && !v.isStream));
            },

            goShorts: function() {
                this.hideAll();
                document.getElementById('navShorts').classList.add('nav-active');
                document.getElementById('mainGrid').style.display = 'grid';
                this.renderVids(this.data.videos.filter(v => v.isShort));
            },

            goStreams: function() {
                this.hideAll();
                document.getElementById('navStreams').classList.add('nav-active');
                document.getElementById('mainGrid').style.display = 'grid';
                this.renderVids(this.data.videos.filter(v => v.isStream));
            },

            goStats: function() {
                this.hideAll();
                document.getElementById('navStats').classList.add('nav-active');
                document.getElementById('statsView').style.display = 'block';
                const s = this.data.stats;
                const myVids = this.data.videos.filter(v => v.author === this.data.user?.name);
                const totalViews = myVids.reduce((acc, v) => acc + (v.views || 0), 0);
                
                document.getElementById('statsBox').innerHTML = `
                    <div style="background:#1a1a1a; padding:20px; border-radius:10px;">üïí Temps pass√©: ${Math.floor(s.time/3600)}h ${Math.floor((s.time%3600)/60)}m</div>
                    <div style="background:#1a1a1a; padding:20px; border-radius:10px;">üëç Likes donn√©s: ${s.likes}</div>
                    <div style="background:#1a1a1a; padding:20px; border-radius:10px;">üì∫ Vid√©os vues: ${s.views}</div>
                    <div style="background:#1a1a1a; padding:20px; border-radius:10px;">üë• Abonnements: ${this.data.subs.length}</div>
                    <div style="background:#1a1a1a; padding:20px; border-radius:10px;">üìà Vues cha√Æne: ${totalViews}</div>
                `;
            },

            goHistory: function() {
                this.hideAll();
                document.getElementById('navHistory').classList.add('nav-active');
                document.getElementById('mainGrid').style.display = 'grid';
                const h = this.data.history.map(id => this.data.videos.find(v => v.id == id)).filter(v => v);
                this.renderVids(h);
            },

            goMyProfile: function() {
                if(!this.data.user) return this.login();
                this.viewProfile(this.data.user.name);
            },

            viewProfile: function(name) {
                this.hideAll();
                document.getElementById('profileView').style.display = 'block';
                const u = this.data.users[name] || { name: name };
                document.getElementById('pName').innerText = name;
                document.getElementById('pAvatarLarge').innerHTML = this.getAvatar(name, true);
                document.getElementById('pBanner').src = u.banner || "https://images.unsplash.com/photo-1579546929518-9e396f3cc809?w=1000";
                
                let btns = "";
                if(this.data.user && this.data.user.name !== name) {
                    const isSub = this.data.subs.includes(name);
                    btns = `<button class="btn-red" onclick="app.toggleSub('${name}')">${isSub ? '‚úÖ ABONN√â' : 'S\'ABONNER'}</button>`;
                }
                document.getElementById('pActions').innerHTML = btns;
                this.renderVids(this.data.videos.filter(v => v.author === name), 'pVideos');
            },

            // --- STREAMING ---
            openStreamModal: function() { this.closeModals(); document.getElementById('modalStreamSetup').style.display='flex'; },
            
            startRealStream: async function() {
                const title = document.getElementById('stTitle').value;
                if(!title) return alert("Titre requis");
                try {
                    this.localStream = await navigator.mediaDevices.getUserMedia({ video: true, audio: true });
                    const id = "live_" + Date.now();
                    const newLive = { id, title, author: this.data.user.name, isStream: true, views: 0, thumb: "https://images.unsplash.com/photo-1516035069371-29a1b244cc32?w=500" };
                    this.data.videos.unshift(newLive);
                    await this.save();
                    this.closeModals();
                    this.goStreams();

                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    const vid = document.createElement('video');
                    vid.srcObject = this.localStream; vid.play();
                    
                    setInterval(() => {
                        ctx.drawImage(vid, 0, 0, canvas.width, canvas.height);
                        streamBus.postMessage({ id, frame: canvas.toDataURL('image/webp', 0.4) });
                    }, 150);
                } catch(e) { alert("Cam√©ra refus√©e."); }
            },

            listenToStreams: function() {
                streamBus.onmessage = (e) => {
                    if(this.activeVid?.id === e.data.id) {
                        const cvs = document.getElementById('liveCanvas');
                        cvs.style.display = 'block';
                        document.getElementById('playerVid').style.display = 'none';
                        const ctx = cvs.getContext('2d');
                        const img = new Image();
                        img.onload = () => ctx.drawImage(img, 0, 0, cvs.width, cvs.height);
                        img.src = e.data.frame;
                    }
                };
            },

            // --- RENDERING ---
            renderVids: function(list, target = 'mainGrid') {
                const el = document.getElementById(target);
                el.innerHTML = list.map(v => `
                    <div class="video-card" onclick="app.openPlayer('${v.id}')" style="cursor:pointer;">
                        <img src="${v.thumb}" style="width:100%; aspect-ratio:16/9; object-fit:cover; border-radius:12px; background:#222;">
                        <div style="display:flex; gap:10px; margin-top:10px;">
                            ${this.getAvatar(v.author)}
                            <div>
                                <h4 style="margin:0; font-size:14px;">${v.title}</h4>
                                <p style="font-size:12px; color:var(--sec-text); margin:4px 0;">${v.author} ‚Ä¢ ${v.views || 0} vues</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            openPlayer: function(id) {
                const v = this.data.videos.find(x => x.id == id);
                this.activeVid = v;
                this.data.stats.views++;
                this.data.history = [id, ...this.data.history.filter(x => x != id)].slice(0, 30);
                localStorage.setItem('mt_history', JSON.stringify(this.data.history));

                document.getElementById('playerModal').style.display = 'block';
                document.getElementById('vidTitle').innerText = v.title;
                const vid = document.getElementById('playerVid');
                vid.src = v.url || "";
                vid.style.display = v.isStream ? 'none' : 'block';
                document.getElementById('liveCanvas').style.display = 'none';
                
                document.getElementById('vidInfo').innerHTML = `
                    <div style="display:flex; align-items:center; gap:12px; cursor:pointer;" onclick="app.closePlayer(); app.viewProfile('${v.author}')">
                        ${this.getAvatar(v.author)} <b>${v.author}</b>
                    </div>
                    <button class="action-pill" onclick="app.doLike()">üëç Like</button>
                `;
                this.renderComments();
            },

            // --- SOCIAL ---
            addComment: function() {
                const text = document.getElementById('comInp').value;
                if(!text || !this.data.user) return;
                if(!this.activeVid.comments) this.activeVid.comments = [];
                this.activeVid.comments.push({ id: Date.now(), author: this.data.user.name, text, heart: false });
                document.getElementById('comInp').value = "";
                this.renderComments();
                this.save();
            },

            renderComments: function() {
                const isOwner = this.data.user?.name === this.activeVid.author;
                document.getElementById('comList').innerHTML = (this.activeVid.comments || []).map(c => `
                    <div class="comment-item">
                        ${this.getAvatar(c.author)}
                        <div>
                            <b>${c.author}</b>
                            <p style="margin:5px 0;">${c.text}</p>
                            ${c.heart ? `<div class="heart-badge">${this.getAvatar(this.activeVid.author, false, true)} ‚ù§Ô∏è</div>` : ''}
                            ${isOwner ? `<button onclick="app.toggleHeart(${c.id})" style="font-size:10px;">C≈ìur</button>` : ''}
                        </div>
                    </div>
                `).join('');
            },

            toggleHeart: function(id) {
                const c = this.activeVid.comments.find(x => x.id === id);
                c.heart = !c.heart;
                this.renderComments();
                this.save();
            },

            toggleSub: function(name) {
                if(this.data.subs.includes(name)) this.data.subs = this.data.subs.filter(n => n !== name);
                else {
                    this.data.subs.push(name);
                    if(Math.random() < 0.01) {
                        const t = document.getElementById('santaToast'); t.style.display='block';
                        setTimeout(() => t.style.display='none', 4000);
                    }
                }
                localStorage.setItem('mt_subs', JSON.stringify(this.data.subs));
                this.updateUI();
                this.viewProfile(name);
            },

            doLike: function() {
                this.data.stats.likes++;
                localStorage.setItem('mt_stats', JSON.stringify(this.data.stats));
                alert("Vid√©o lik√©e !");
            },

            // --- AUTH & UI ---
            updateUI: function() {
                const area = document.getElementById('authArea');
                if(this.data.user) {
                    area.innerHTML = `
                        <button onclick="app.openCreate()" style="background:none; border:none; color:white; font-size:22px; cursor:pointer; margin-right:15px;">‚ûï</button>
                        <div onclick="app.toggleMenu()">${this.getAvatar(this.data.user.name)}</div>
                    `;
                    document.getElementById('menuUser').innerText = this.data.user.name;
                    if(this.data.user.email === ADMIN_EMAIL) document.getElementById('adminLink').style.display = 'flex';
                } else {
                    area.innerHTML = `<button class="btn-blue" onclick="app.login()">Connexion</button>`;
                }

                document.getElementById('sidebarSubs').innerHTML = this.data.subs.map(s => `
                    <div class="nav-item" onclick="app.viewProfile('${s}')">
                        ${this.getAvatar(s, false, true)} <span>${s}</span>
                    </div>
                `).join('');
            },

            getAvatar: function(name, large = false, sidebar = false) {
                const u = this.data.users[name];
                let cls = large ? 'avatar-letter' : 'avatar-img';
                if(sidebar) cls += ' avatar-sidebar';
                if(u && u.avatar) return `<img src="${u.avatar}" class="${cls}" style="${large ? 'width:100px; height:100px; font-size:40px;' : ''}">`;
                return `<div class="avatar-letter ${sidebar ? 'avatar-sidebar' : ''}" style="${large ? 'width:100px; height:100px; font-size:40px;' : ''}">${name.charAt(0).toUpperCase()}</div>`;
            },

            login: function() {
                const n = prompt("Pseudo ?");
                const e = prompt("Email ?");
                if(n && e) {
                    this.data.user = { name: n, email: e };
                    localStorage.setItem('mt_user', JSON.stringify(this.data.user));
                    if(!this.data.users[n]) this.data.users[n] = { name: n, email: e, avatar: null };
                    this.save().then(() => location.reload());
                }
            },

            doLogout: function() { localStorage.removeItem('mt_user'); location.reload(); },
            toggleMenu: function() { const m = document.getElementById('accountMenu'); m.style.display = m.style.display === 'none' ? 'block' : 'none'; },
            openCreate: function() { document.getElementById('modalCreate').style.display = 'flex'; },
            closeModals: function() { document.querySelectorAll('.modal').forEach(m => m.style.display = 'none'); },
            closePlayer: function() { document.getElementById('playerModal').style.display = 'none'; document.getElementById('playerVid').pause(); this.activeVid = null; },
            
            // --- ADMIN ---
            goAdmin: function() {
                this.hideAll();
                document.getElementById('adminPanel').style.display = 'block';
                document.getElementById('adminList').innerHTML = this.data.videos.map(v => `
                    <div style="background:#222; padding:10px; margin-bottom:5px; border-radius:8px; display:flex; justify-content:space-between;">
                        <span>${v.title} (${v.author})</span>
                        <button onclick="app.delVid('${v.id}')" style="color:red; background:none; border:none; cursor:pointer;">Supprimer</button>
                    </div>
                `).join('');
            },
            delVid: async function(id) { if(confirm("Supprimer ?")) { this.data.videos = this.data.videos.filter(v => v.id != id); await this.save(); this.goAdmin(); } },
            editCredits: async function() {
                const nc = prompt("Nouveaux cr√©dits :", this.data.credits);
                if(nc) { this.data.credits = nc; await this.save(); location.reload(); }
            }
        };

        app.init();
    </script>
</body>
</html>
