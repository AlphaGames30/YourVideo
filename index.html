<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VISIONA TITAN V32 - STABLE & CONNECT√â</title>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
        /* DESIGN SYSTEM COMPLET */
        :root {
            --v-bg: #020202; --v-sidebar: #060606; --v-card: #0e0e0e;
            --v-accent: #7c4dff; --v-text: #ffffff; --v-text-sec: #888;
            --v-border: #1a1a1a; --v-red: #ff3e3e; --v-gold: #ffc107;
            --v-radius: 20px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Plus Jakarta Sans', sans-serif; }
        body { background: var(--v-bg); color: var(--v-text); overflow: hidden; height: 100vh; }

        /* SCROLLBAR */
        ::-webkit-scrollbar { width: 5px; }
        ::-webkit-scrollbar-thumb { background: var(--v-border); border-radius: 10px; }

        /* HEADER */
        header {
            height: 80px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 30px; border-bottom: 1px solid var(--v-border); background: rgba(2,2,2,0.9);
            backdrop-filter: blur(15px); position: sticky; top: 0; z-index: 1000;
        }

        .search-bar {
            flex: 1; max-width: 500px; display: flex; background: #000;
            border: 1px solid var(--v-border); border-radius: 40px; padding: 5px; margin: 0 20px;
        }
        .search-bar input {
            flex: 1; background: transparent; border: none; color: #fff; padding: 10px 20px; outline: none;
        }
        .search-bar button {
            background: var(--v-accent); border: none; color: #fff; padding: 8px 20px; border-radius: 30px; cursor: pointer; font-weight: bold;
        }

        /* LAYOUT */
        .main-wrapper { display: flex; height: calc(100vh - 80px); }
        
        .sidebar {
            width: 260px; background: var(--v-sidebar); border-right: 1px solid var(--v-border);
            padding: 20px; overflow-y: auto; flex-shrink: 0;
        }

        .nav-link {
            display: flex; align-items: center; gap: 12px; padding: 12px 15px;
            border-radius: 12px; color: var(--v-text-sec); text-decoration: none;
            font-weight: 600; cursor: pointer; margin-bottom: 5px;
        }
        .nav-link:hover, .nav-link.active { background: var(--v-card); color: #fff; }
        .nav-link.active { color: var(--v-accent); }

        .content-area { flex: 1; padding: 30px; overflow-y: auto; background: var(--v-bg); }

        /* GRID SYSTEM */
        .video-grid {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 20px;
        }
        .v-card { cursor: pointer; transition: transform 0.3s; }
        .v-card:hover { transform: translateY(-5px); }
        .v-thumb { width: 100%; aspect-ratio: 16/9; border-radius: var(--v-radius); object-fit: cover; background: #111; }
        
        /* ZAPPS SPECIAL FORMAT */
        .zapp-container {
            display: flex; flex-direction: column; align-items: center; gap: 30px; padding-bottom: 50px;
        }
        .zapp-card {
            width: 380px; height: 680px; background: #000; border-radius: 30px;
            position: relative; overflow: hidden; scroll-snap-align: center; border: 1px solid var(--v-border);
        }
        .zapp-video { width: 100%; height: 100%; object-fit: cover; }

        /* PLAYER OVERLAY */
        .player-overlay {
            position: fixed; inset: 0; background: var(--v-bg); z-index: 2000;
            display: none; overflow-y: auto; padding: 30px;
        }

        /* PROFILE */
        .banner { height: 220px; border-radius: 25px; background: #1a1a1a; background-size: cover; position: relative; }
        .pdp-large { 
            width: 120px; height: 120px; border-radius: 50%; border: 5px solid var(--v-bg);
            position: absolute; bottom: -50px; left: 30px; background: #222;
        }
    </style>
</head>
<body>

<header>
    <div style="display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="VT.nav('home')">
        <div style="width:45px; height:45px; background:var(--v-accent); border-radius:12px; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:24px;">V</div>
        <h2 style="font-weight:900; letter-spacing:-1px;">VISIONA</h2>
    </div>
    <div class="search-bar">
        <input type="text" id="q" placeholder="Rechercher">
        <button onclick="VT.search()">Rechercher</button>
    </div>
    <div id="top-right-ui" style="display:flex; align-items:center; gap:20px;"></div>
</header>

<div class="main-wrapper">
    <aside class="sidebar">
        <div class="nav-link active" id="n-home" onclick="VT.nav('home')">üè† Accueil</div>
        <div class="nav-link" id="n-zapps" onclick="VT.nav('zapps')">‚ö° Visiona Zapps</div>
        <div class="nav-link" onclick="VT.nav('thanks')">üíé Remerciements</div>
        
        <div style="margin: 25px 0 10px 15px; font-size: 11px; font-weight: 800; color: var(--v-text-sec); text-transform: uppercase;">Abonnements</div>
        <div id="sidebar-subs"></div>

        <div id="admin-btn" style="display:none; margin-top:30px;">
            <div class="nav-link" onclick="VT.nav('admin')" style="color:var(--v-gold);">üîë Administration</div>
        </div>
    </aside>

    <main class="content-area">
        <div id="page-home">
            <h2 style="margin-bottom:25px;">Vid√©os recommand√©es</h2>
            <div class="video-grid" id="home-feed"></div>
        </div>

        <div id="page-zapps" style="display:none;" class="zapp-container"></div>

        <div id="page-profile" style="display:none;">
            <div id="prof-banner" class="banner">
                <img id="prof-pdp" src="" class="pdp-large">
            </div>
            <div style="margin: 60px 0 30px 30px; display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <h1 id="prof-name">Nom</h1>
                    <p id="prof-count" style="color:var(--v-text-sec);">0 Abonn√©s</p>
                </div>
                <div id="prof-actions"></div>
            </div>
            <div style="display:flex; gap:30px; border-bottom:1px solid var(--v-border); margin-bottom:25px;">
                <div class="nav-link active">VID√âOS</div>
                <div class="nav-link">ZAPPS</div>
                <div class="nav-link">√Ä PROPOS</div>
            </div>
            <div class="video-grid" id="prof-videos"></div>
        </div>
    </main>
</div>

<div id="video-player" class="player-overlay">
    <button onclick="VT.closePlayer()" style="background:var(--v-card); color:#fff; border:none; padding:10px 25px; border-radius:10px; cursor:pointer; margin-bottom:20px;">‚Üê FERMER</button>
    <div style="max-width:1200px; margin:0 auto;">
        <video id="main-v" controls autoplay style="width:100%; border-radius:20px; background:#000;"></video>
        <h1 id="v-title" style="margin-top:20px;">Titre</h1>
        <div style="display:flex; justify-content:space-between; margin-top:10px; color:var(--v-text-sec);">
            <span id="v-meta">Vues</span>
            <div style="display:flex; gap:20px; background:var(--v-card); padding:10px 20px; border-radius:30px;">
                <button onclick="VT.like()" style="background:none; border:none; color:#fff; cursor:pointer; font-weight:bold;">üëç <span id="v-likes">0</span></button>
                <button onclick="VT.dislike()" style="background:none; border:none; color:#fff; cursor:pointer; font-weight:bold;">üëé</button>
            </div>
        </div>
        <hr style="border:0; border-top:1px solid var(--v-border); margin:30px 0;">
        <div id="v-author-zone" style="display:flex; align-items:center; justify-content:space-between;"></div>
        <div style="margin-top:40px;">
            <h3>Commentaires</h3>
            <div style="display:flex; gap:15px; margin-top:20px;">
                <input type="text" id="com-in" placeholder="Commenter..." style="flex:1; background:transparent; border:none; border-bottom:1px solid var(--v-border); color:#fff; padding:10px;">
                <button onclick="VT.addComment()" style="background:var(--v-accent); border:none; color:#fff; padding:0 20px; border-radius:10px; cursor:pointer;">Envoyer</button>
            </div>
            <div id="com-list" style="margin-top:30px;"></div>
        </div>
    </div>
</div>

<div id="auth-modal" style="display:none; position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:3000; align-items:center; justify-content:center;">
    <div style="background:var(--v-sidebar); padding:40px; border-radius:25px; width:400px; border:1px solid var(--v-border);">
        <h2 style="margin-bottom:20px; text-align:center;">Connexion</h2>
        <input type="text" id="a-pseudo" placeholder="Pseudo" style="width:100%; padding:12px; margin-bottom:10px; background:#000; border:1px solid var(--v-border); color:#fff; border-radius:10px;">
        <input type="email" id="a-email" placeholder="Email" style="width:100%; padding:12px; margin-bottom:10px; background:#000; border:1px solid var(--v-border); color:#fff; border-radius:10px;">
        <input type="password" id="a-pass" placeholder="Mot de passe" style="width:100%; padding:12px; margin-bottom:20px; background:#000; border:1px solid var(--v-border); color:#fff; border-radius:10px;">
        <button onclick="VT.login()" style="width:100%; padding:12px; background:var(--v-accent); border:none; color:#fff; border-radius:10px; font-weight:bold; cursor:pointer;">SE CONNECTER</button>
    </div>
</div>

<script>
    const GIST = "https://gist.githubusercontent.com/AlphaGames30/5248424f9cc79feb78c0560faad87c92/raw/video.json";
    const WORK = "https://mytubeupload.edonis-imbert.workers.dev/";

    const VT = {
        state: {
            user: JSON.parse(localStorage.getItem('vt_user')) || null,
            db: { videos: [], users: {} },
            subs: JSON.parse(localStorage.getItem('vt_subs')) || [],
            active: null
        },

        async init() {
            await this.sync();
            this.renderTopUI();
            this.renderSubs();
            this.nav('home');
            this.checkEaster();
        },

        async sync() {
            const r = await fetch(`${GIST}?t=${Date.now()}`);
            this.state.db = await r.json();
        },

        async save() {
            await fetch(WORK, {
                method: 'PATCH',
                body: JSON.stringify({ files: { "video.json": { content: JSON.stringify(this.state.db, null, 2) } } })
            });
        },

        nav(page) {
            document.querySelectorAll('main > div').forEach(d => d.style.display = 'none');
            document.getElementById('page-' + page).style.display = (page === 'zapps') ? 'flex' : 'block';
            if(page === 'home') this.renderHome();
            if(page === 'zapps') this.renderZapps();
        },

        renderHome() {
            const h = document.getElementById('home-feed');
            h.innerHTML = this.state.db.videos.filter(v => !v.isShort).map(v => `
                <div class="v-card" onclick="VT.openPlayer('${v.id}')">
                    <img class="v-thumb" src="${v.thumb}">
                    <div style="display:flex; gap:12px; margin-top:12px;">
                        <img src="${this.getAv(v.author)}" style="width:36px; height:36px; border-radius:50%;" onclick="event.stopPropagation(); VT.openProfile('${v.author}')">
                        <div>
                            <h4 style="font-size:14px; color:#fff;">${v.title}</h4>
                            <p style="font-size:12px; color:var(--v-text-sec);">${v.author} ‚Ä¢ ${v.views} vues</p>
                        </div>
                    </div>
                </div>
            `).join('');
        },

        renderZapps() {
            const z = document.getElementById('page-zapps');
            z.innerHTML = this.state.db.videos.filter(v => v.isShort).map(v => `
                <div class="zapp-card">
                    <video class="zapp-video" src="${v.url}" loop autoplay muted onclick="VT.openPlayer('${v.id}')"></video>
                    <div style="position:absolute; bottom:20px; left:20px; z-index:10;">
                        <b onclick="VT.openProfile('${v.author}')" style="cursor:pointer;">@${v.author}</b>
                        <p style="font-size:13px;">${v.title}</p>
                    </div>
                </div>
            `).join('');
        },

        openProfile(pseudo) {
            const u = this.state.db.users[pseudo] || { subscribersCount: 0 };
            this.nav('profile');
            document.getElementById('prof-name').innerText = pseudo;
            document.getElementById('prof-pdp').src = this.getAv(pseudo);
            document.getElementById('prof-count').innerText = `${u.subscribersCount} Abonn√©s`;
            
            const vids = this.state.db.videos.filter(v => v.author === pseudo);
            document.getElementById('prof-videos').innerHTML = vids.map(v => `
                <div class="v-card" onclick="VT.openPlayer('${v.id}')">
                    <img class="v-thumb" src="${v.thumb}">
                    <h4 style="margin-top:10px;">${v.title}</h4>
                </div>
            `).join('');

            const act = document.getElementById('prof-actions');
            if(this.state.user?.name === pseudo) {
                act.innerHTML = `<button onclick="VT.logout()" style="background:var(--v-red); color:#fff; border:none; padding:10px 20px; border-radius:10px; cursor:pointer;">D√©connexion</button>`;
            } else {
                const isSub = this.state.subs.includes(pseudo);
                act.innerHTML = `<button onclick="VT.toggleSub('${pseudo}')" style="background:${isSub?'var(--v-border)':'#fff'}; color:${isSub?'#fff':'#000'}; border:none; padding:10px 25px; border-radius:10px; font-weight:bold; cursor:pointer;">${isSub?'ABONN√â':"S'ABONNER"}</button>`;
            }
        },

        openPlayer(id) {
            const v = this.state.db.videos.find(x => x.id == id);
            this.state.active = v;
            v.views++;
            document.getElementById('video-player').style.display = 'block';
            document.getElementById('main-v').src = v.url;
            document.getElementById('v-title').innerText = v.title;
            document.getElementById('v-likes').innerText = v.likes || 0;
            this.renderAuthorBar();
            this.renderComs();
            this.save();
        },

        renderAuthorBar() {
            const v = this.state.active;
            const isSub = this.state.subs.includes(v.author);
            document.getElementById('v-author-zone').innerHTML = `
                <div style="display:flex; align-items:center; gap:15px; cursor:pointer;" onclick="VT.openProfile('${v.author}')">
                    <img src="${this.getAv(v.author)}" style="width:50px; height:50px; border-radius:50%;">
                    <b>${v.author}</b>
                </div>
                <button onclick="VT.toggleSub('${v.author}')" style="background:${isSub?'var(--v-border)':'#fff'}; color:${isSub?'#fff':'#000'}; border:none; padding:10px 25px; border-radius:10px; font-weight:bold; cursor:pointer;">${isSub?'ABONN√â':"S'ABONNER"}</button>
            `;
        },

        toggleSub(p) {
            if(!this.state.user) return this.showAuth();
            const i = this.state.subs.indexOf(p);
            if(i > -1) this.state.subs.splice(i, 1);
            else this.state.subs.push(p);
            
            localStorage.setItem('vt_subs', JSON.stringify(this.state.subs));
            this.renderSubs();
            if(this.state.active) this.renderAuthorBar();
            this.openProfile(p);
        },

        renderSubs() {
            document.getElementById('sidebar-subs').innerHTML = this.state.subs.map(s => `
                <div class="nav-link" onclick="VT.openProfile('${s}')">
                    <img src="${this.getAv(s)}" style="width:24px; height:24px; border-radius:50%;">
                    <span>${s}</span>
                </div>
            `).join('');
        },

        addComment() {
            const val = document.getElementById('com-in').value;
            if(!val || !this.state.user) return;
            if(!this.state.active.comments) this.state.active.comments = [];
            this.state.active.comments.unshift({ author: this.state.user.name, text: val });
            document.getElementById('com-in').value = "";
            this.renderComs();
            this.save();
        },

        renderComs() {
            const c = this.state.active.comments || [];
            document.getElementById('com-list').innerHTML = c.map(x => `
                <div style="display:flex; gap:15px; margin-bottom:20px;">
                    <img src="${this.getAv(x.author)}" style="width:35px; height:35px; border-radius:50%;">
                    <div><b>${x.author}</b><p style="margin-top:5px;">${x.text}</p></div>
                </div>
            `).join('');
        },

        login() {
            const p = document.getElementById('a-pseudo').value;
            if(!p) return;
            this.state.user = { name: p };
            localStorage.setItem('vt_user', JSON.stringify(this.state.user));
            location.reload();
        },

        logout() { localStorage.removeItem('vt_user'); location.reload(); },
        renderTopUI() {
            const ui = document.getElementById('top-right-ui');
            if(this.state.user) {
                ui.innerHTML = `<img src="${this.getAv(this.state.user.name)}" style="width:40px; height:40px; border-radius:50%; cursor:pointer;" onclick="VT.openProfile('${this.state.user.name}')">`;
                if(this.state.user.name === "Admin") document.getElementById('admin-btn').style.display = "block";
            } else {
                ui.innerHTML = `<button onclick="VT.showAuth()" style="background:var(--v-accent); color:#fff; border:none; padding:10px 20px; border-radius:10px; font-weight:bold; cursor:pointer;">Connexion</button>`;
            }
        },

        getAv(n) { return `https://ui-avatars.com/api/?name=${n}&background=7c4dff&color=fff&bold=true`; },
        showAuth() { document.getElementById('auth-modal').style.display = 'flex'; },
        closePlayer() { document.getElementById('video-player').style.display = 'none'; document.getElementById('main-v').pause(); },
        checkEaster() { window.addEventListener('keydown', e => { if(e.key === 'a') document.body.style.filter = "invert(1)"; }); }
    };

    window.onload = () => VT.init();
</script>
</body>
</html>
