<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyTube Cloud - Edonis</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <div class="header-left">
            <span class="logo">â–¶ MyTube</span>
            <div id="admin-tools" style="display:none;">
                <span class="badge-admin">ADMIN</span>
            </div>
        </div>
        <div class="search-bar">
            <input type="text" id="search-input" placeholder="Rechercher une vidÃ©o...">
            <button onclick="searchVideo()">ğŸ”</button>
        </div>
        <div class="header-right">
            <button class="btn-login" onclick="loginGoogle()">Connexion</button>
        </div>
    </header>

    <div class="main-container">
        <nav class="sidebar">
            <ul>
                <li onclick="location.reload()">ğŸ  Accueil</li>
                <li>ğŸ“± Shorts</li>
                <li>ğŸ“º Abonnements</li>
                <hr>
                <li>ğŸ•’ Historique</li>
                <li>ğŸ‘¤ Ma ChaÃ®ne</li>
            </ul>
        </nav>

        <main class="feed">
            <section id="upload-box" class="admin-panel">
                <h3>Publier un fichier MP4 (Cloud)</h3>
                <input type="text" id="v-title" placeholder="Titre de la vidÃ©o">
                <input type="file" id="v-file" accept="video/mp4">
                <button id="btn-upload">ğŸš€ Publier sur Firebase</button>
            </section>

            <section id="admin-panel" class="admin-panel" style="display:none;">
                <h3>Ajouter via lien direct (GitHub Sync)</h3>
                <input type="text" id="new-title" placeholder="Titre">
                <input type="text" id="new-url" placeholder="Lien MP4 direct">
                <button onclick="autoUploadToGithub()">ğŸ’¾ Sauvegarder sur GitHub</button>
            </section>

            <h2 class="section-title">Shorts</h2>
            <div id="shorts-grid" class="shorts-row"></div>

            <h2 class="section-title">VidÃ©os suggÃ©rÃ©es</h2>
            <div id="video-grid" class="video-grid"></div>
        </main>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "TA_CLE",
            authDomain: "TON_DOMAIN",
            projectId: "TON_ID",
            storageBucket: "TON_BUCKET",
            appId: "TON_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Upload Firebase
        document.getElementById('btn-upload').addEventListener('click', async () => {
            const file = document.getElementById('v-file').files[0];
            const title = document.getElementById('v-title').value;
            if (!file || !title) return alert("Remplis tout !");

            const storageRef = ref(storage, 'videos/' + file.name);
            const snapshot = await uploadBytes(storageRef, file);
            const url = await getDownloadURL(snapshot.ref);

            await addDoc(collection(db, "videos"), {
                title: title,
                url: url,
                likes: 0,
                type: "long"
            });
            alert("PubliÃ© !");
        });

        // Lecture en temps rÃ©el Firebase
        onSnapshot(query(collection(db, "videos")), (snapshot) => {
            snapshot.docChanges().forEach((change) => {
                if (change.type === "added") {
                    renderVideo(change.doc.data());
                }
            });
        });
    </script>
    <script src="app.js"></script>
</body>
</html>
