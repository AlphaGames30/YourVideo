<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>VISIONA TITAN V35 - ULTRA-DENSE CORE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* ==========================================================================
           [STYLE SYSTEM - SECTION 1/3]
           LOGIQUE DE DESIGN ET COMPOSANTS GRAPHIQUES
           ==========================================================================
        */
        :root {
            --v-bg: #030303;
            --v-sidebar: #080808;
            --v-card: #0f0f0f;
            --v-accent: #7c4dff;
            --v-accent-low: rgba(124, 77, 255, 0.2);
            --v-text: #ffffff;
            --v-text-sec: #9ea4b0;
            --v-border: #1e1e1e;
            --v-red: #ff3e3e;
            --v-green: #00f2ff;
            --v-gold: #ffc400;
            --v-radius-lg: 28px;
            --v-radius-sm: 14px;
            --v-shadow: 0 15px 45px rgba(0,0,0,0.8);
        }

        /* RESET & CORE BODY */
        * { margin: 0; padding: 0; box-sizing: border-box; outline: none; transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1); }
        body { 
            background: var(--v-bg); color: var(--v-text); 
            font-family: 'Plus Jakarta Sans', sans-serif; 
            overflow: hidden; height: 100vh; width: 100vw;
        }

        /* SCROLLBAR ENGINE */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: var(--v-bg); }
        ::-webkit-scrollbar-thumb { background: #2a2a2a; border-radius: 10px; border: 2px solid var(--v-bg); }
        ::-webkit-scrollbar-thumb:hover { background: var(--v-accent); }

        /* HEADER ARCHITECTURE */
        header {
            height: 95px; display: flex; align-items: center; justify-content: space-between;
            padding: 0 45px; background: rgba(3,3,3,0.98); border-bottom: 1px solid var(--v-border);
            backdrop-filter: blur(25px); z-index: 5000; position: relative;
        }

        .search-engine {
            flex: 1; max-width: 650px; margin: 0 50px; display: flex; align-items: center;
            background: #000; border: 1px solid var(--v-border); border-radius: 60px; padding: 6px;
        }
        .search-engine input {
            flex: 1; background: transparent; border: none; color: #fff;
            padding: 12px 25px; font-size: 16px; font-weight: 500;
        }
        .search-engine input::placeholder { color: var(--v-text-sec); }
        .search-engine button {
            background: var(--v-accent); color: #fff; border: none;
            padding: 12px 30px; border-radius: 50px; font-weight: 800; cursor: pointer;
            box-shadow: 0 5px 15px var(--v-accent-low);
        }

        /* LAYOUT ARCHITECTURE */
        .app-shell { display: flex; height: calc(100vh - 95px); width: 100%; position: relative; }

        /* SIDEBAR LOGIC */
        .sidebar {
            width: 290px; background: var(--v-sidebar); border-right: 1px solid var(--v-border);
            padding: 30px 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px;
        }
        .nav-item {
            display: flex; align-items: center; gap: 16px; padding: 15px 20px;
            border-radius: var(--v-radius-sm); color: var(--v-text-sec); font-weight: 700;
            cursor: pointer; text-decoration: none; position: relative;
        }
        .nav-item:hover, .nav-item.active { background: var(--v-card); color: #fff; }
        .nav-item.active { color: var(--v-accent); border-left: 5px solid var(--v-accent); }
        
        .sub-item {
            display: flex; align-items: center; gap: 12px; padding: 10px 20px;
            border-radius: 12px; cursor: pointer; margin-bottom: 2px;
        }
        .sub-item img { width: 32px; height: 32px; border-radius: 50%; object-fit: cover; }
        .sub-item:hover { background: #1a1a1a; }

        /* VIEWPORT ARCHITECTURE */
        .viewport { flex: 1; padding: 45px; overflow-y: auto; scroll-behavior: smooth; }
        .view-section { display: none; animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }

        /* GRID SYSTEM (HOME) */
        .video-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 35px; }
        .v-card { position: relative; cursor: pointer; }
        .v-thumb-wrapper {
            width: 100%; aspect-ratio: 16/9; border-radius: var(--v-radius-lg);
            overflow: hidden; background: #111; border: 1px solid var(--v-border);
        }
        .v-thumb-wrapper img { width: 100%; height: 100%; object-fit: cover; }
        .v-meta { display: flex; gap: 15px; margin-top: 18px; }
        .v-pdp { width: 44px; height: 44px; border-radius: 50%; flex-shrink: 0; background: #222; }

        /* ZAPPS FORMAT (9:16) */
        .zapps-container {
            display: flex; flex-direction: column; align-items: center; gap: 60px;
            padding-bottom: 100px;
        }
        .zapp-frame {
            width: 420px; height: 800px; background: #000; border-radius: 40px;
            position: relative; overflow: hidden; border: 3px solid var(--v-border);
            scroll-snap-align: center; box-shadow: 0 30px 60px rgba(0,0,0,0.5);
        }
        .zapp-video { width: 100%; height: 100%; object-fit: cover; }
        .zapp-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 35%;
            background: linear-gradient(transparent, rgba(0,0,0,0.95));
            padding: 35px; display: flex; flex-direction: column; justify-content: flex-end;
        }
        .zapp-controls {
            position: absolute; right: 20px; bottom: 120px; display: flex;
            flex-direction: column; gap: 30px; align-items: center;
        }
        .z-btn {
            width: 55px; height: 55px; border-radius: 50%; background: rgba(40,40,40,0.6);
            backdrop-filter: blur(10px); display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 22px;
        }

        /* PROFILE ARCHITECTURE */
        .profile-hero {
            height: 280px; border-radius: 35px; background: #1a1a1a; position: relative;
            background-size: cover; background-position: center; margin-bottom: 90px;
        }
        .profile-avatar-box {
            position: absolute; bottom: -70px; left: 50px; display: flex; align-items: flex-end; gap: 30px;
        }
        .p-avatar { width: 160px; height: 160px; border-radius: 50%; border: 8px solid var(--v-bg); background: #222; }
        .p-tabs { display: flex; gap: 45px; border-bottom: 1px solid var(--v-border); margin-bottom: 40px; }
        .tab-btn {
            padding: 18px 5px; background: none; border: none; color: var(--v-text-sec);
            font-weight: 800; cursor: pointer; position: relative; font-size: 15px;
        }
        .tab-btn.active { color: var(--v-accent); }
        .tab-btn.active::after { content: ''; position: absolute; bottom: 0; left: 0; width: 100%; height: 4px; background: var(--v-accent); border-radius: 10px; }

        /* PLAYER OVERLAY ENGINE */
        #master-player-overlay {
            display: none; position: fixed; inset: 0; background: var(--v-bg);
            z-index: 10000; overflow-y: auto; padding: 50px;
        }
        .player-content { max-width: 1500px; margin: 0 auto; display: grid; grid-template-columns: 1fr 400px; gap: 50px; }

        /* AUTH MODAL */
        #auth-modal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.95);
            z-index: 20000; align-items: center; justify-content: center; backdrop-filter: blur(15px);
        }
        .auth-card {
            background: var(--v-sidebar); padding: 55px; border-radius: 40px; width: 480px;
            border: 1px solid var(--v-border); box-shadow: var(--v-shadow);
        }
        .auth-input {
            width: 100%; padding: 18px; background: #000; border: 1px solid var(--v-border);
            color: #fff; border-radius: 16px; margin-bottom: 15px; font-size: 16px;
        }
        .auth-btn {
            width: 100%; padding: 18px; background: var(--v-accent); color: white; border: none;
            border-radius: 16px; font-weight: 900; cursor: pointer; font-size: 16px;
        }
    </style>
</head>
<body>

    <header>
        <div style="display:flex; align-items:center; gap:25px; cursor:pointer;" onclick="VT.navigate('home')">
            <div id="logo-v" style="width:55px; height:55px; background:var(--v-accent); border-radius:18px; display:flex; align-items:center; justify-content:center; font-weight:900; font-size:30px; box-shadow:0 10px 20px var(--v-accent-low);">V</div>
            <h1 style="letter-spacing:-2px; font-weight:900; font-size:32px;">VISIONA</h1>
        </div>

        <div class="search-engine">
            <input type="text" id="main-search-input" placeholder="Rechercher sur Visiona...">
            <button onclick="VT.searchAction()">Explorer</button>
        </div>

        <div style="display:flex; align-items:center; gap:30px;">
            <div id="v-balance" style="color:var(--v-gold); font-weight:900; font-size:16px;">0 CR</div>
            <div style="position:relative; cursor:pointer;" onclick="VT.toggleNotifications()">
                <span style="font-size:26px;">üîî</span>
                <div id="notif-badge" style="position:absolute; top:-6px; right:-6px; background:var(--v-red); font-size:11px; padding:3px 7px; border-radius:50%; font-weight:bold;">0</div>
            </div>
            <div id="auth-entry-point"></div>
        </div>
    </header>

    <div class="app-shell">
        <aside class="sidebar">
            <div class="nav-item active" id="menu-home" onclick="VT.navigate('home')">üè† Accueil</div>
            <div class="nav-item" id="menu-zapps" onclick="VT.navigate('zapps')">‚ö° Visiona Zapps</div>
            <div class="nav-item" id="menu-hist" onclick="VT.navigate('history')">üïí Historique</div>
            <div class="nav-item" onclick="VT.navigate('thanks')">üíé Remerciements</div>

            <div style="margin-top:40px; font-size:12px; font-weight:900; color:var(--v-text-sec); text-transform:uppercase; letter-spacing:1.5px; margin-left:20px; margin-bottom:10px;">Abonnements</div>
            <div id="sidebar-subscriptions-list"></div>

            <div id="admin-access" style="display:none; margin-top:auto; padding-top:20px; border-top:1px solid var(--v-border);">
                <div class="nav-item" onclick="VT.navigate('admin')" style="color:var(--v-gold);">üîë Ma√Ætre Alpha</div>
            </div>
        </aside>

        <main class="viewport">
            
            <div id="view-home" class="view-section">
                <h2 style="margin-bottom:35px; font-weight:900; font-size:32px;">Recommandations</h2>
                <div id="home-grid-container" class="video-grid"></div>
            </div>

            <div id="view-zapps" class="view-section">
                <div id="zapps-wrapper" class="zapps-container"></div>
            </div>

            <div id="view-history" class="view-section">
                <h2 style="margin-bottom:35px; font-weight:900;">Tableau de Bord & Historique</h2>
                <div id="stats-banner" style="display:grid; grid-template-columns: repeat(3, 1fr); gap:20px; margin-bottom:40px;">
                    <div style="background:var(--v-card); padding:25px; border-radius:20px; border:1px solid var(--v-border);">
                        <p style="color:var(--v-text-sec);">Vues Totales</p>
                        <h2 id="st-views" style="font-size:30px;">0</h2>
                    </div>
                    <div style="background:var(--v-card); padding:25px; border-radius:20px; border:1px solid var(--v-border);">
                        <p style="color:var(--v-text-sec);">Temps de visionnage</p>
                        <h2 id="st-time" style="font-size:30px;">0 min</h2>
                    </div>
                    <div style="background:var(--v-card); padding:25px; border-radius:20px; border:1px solid var(--v-border);">
                        <p style="color:var(--v-text-sec);">Cr√©dits cumul√©s</p>
                        <h2 id="st-creds" style="font-size:30px; color:var(--v-gold);">0</h2>
                    </div>
                </div>
                <div id="history-list" class="video-grid"></div>
            </div>

            <div id="view-profile" class="view-section">
                <div id="p-hero" class="profile-hero">
                    <div class="profile-avatar-box">
                        <img id="p-pdp-main" src="" class="p-avatar">
                        <div style="padding-bottom:15px;">
                            <h2 id="p-username-display" style="font-size:42px; margin:0;">Utilisateur</h2>
                            <p id="p-subs-count" style="color:var(--v-text-sec); font-weight:700;">0 Abonn√©s</p>
                        </div>
                    </div>
                    <div style="position:absolute; right:30px; bottom:20px; display:flex; gap:15px;">
                        <button id="p-edit-action" onclick="VT.showProfileEditor()" style="display:none; background:rgba(255,255,255,0.1); backdrop-filter:blur(10px); border:1px solid rgba(255,255,255,0.2); color:#fff; padding:12px 25px; border-radius:14px; cursor:pointer; font-weight:bold;">Modifier ma cha√Æne</button>
                        <button id="p-logout-action" onclick="VT.logout()" style="display:none; background:var(--v-red); color:#fff; border:none; padding:12px 25px; border-radius:14px; cursor:pointer; font-weight:bold;">Se d√©connecter</button>
                    </div>
                </div>

                <div class="p-tabs">
                    <button class="tab-btn active" onclick="VT.switchProfileTab('videos', this)">VID√âOS</button>
                    <button class="tab-btn" onclick="VT.switchProfileTab('zapps', this)">ZAPPS</button>
                    <button class="tab-btn" onclick="VT.switchProfileTab('posts', this)">PUBLICATIONS</button>
                    <button class="tab-btn" onclick="VT.switchProfileTab('live', this)">DIRECTS</button>
                    <button class="tab-btn" onclick="VT.switchProfileTab('about', this)">√Ä PROPOS</button>
                </div>
                <div id="profile-content-target"></div>
            </div>

            <div id="view-admin" class="view-section">
                <h2 style="color:var(--v-gold); font-weight:900; margin-bottom:35px;">Panel d'Administration Alpha</h2>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:30px;">
                    <div class="auth-card" style="width:100%;">
                        <h3>Gestion des Cr√©dits</h3>
                        <input type="text" id="adm-pseudo" class="auth-input" placeholder="Pseudo exact" style="margin-top:20px;">
                        <input type="number" id="adm-val" class="auth-input" placeholder="Montant">
                        <button onclick="VT.adminCredits()" class="auth-btn">AJOUTER CR√âDITS</button>
                    </div>
                    <div class="auth-card" style="width:100%;">
                        <h3>Syst√®me de Remerciements</h3>
                        <input type="text" id="adm-th-pseudo" class="auth-input" placeholder="Pseudo" style="margin-top:20px;">
                        <input type="text" id="adm-th-role" class="auth-input" placeholder="R√¥le (ex: Donateur)">
                        <button onclick="VT.adminThanks()" class="auth-btn" style="background:var(--v-gold); color:black;">AJOUTER AU HALL OF FAME</button>
                    </div>
                </div>
            </div>

        </main>
    </div>

    <div id="master-player-overlay">
        <button onclick="VT.closePlayer()" style="background:var(--v-card); border:1px solid var(--v-border); color:white; padding:14px 35px; border-radius:16px; font-weight:800; cursor:pointer; margin-bottom:35px;">‚Üê RETOUR √Ä LA NAVIGATION</button>
        <div class="player-content">
            <div class="player-left">
                <div style="width:100%; aspect-ratio:16/9; background:#000; border-radius:35px; overflow:hidden; border:1px solid var(--v-border);">
                    <video id="v-core-engine" controls autoplay style="width:100%; height:100%;"></video>
                </div>
                <h1 id="v-core-title" style="margin-top:30px; font-size:32px; font-weight:900;">Titre de la vid√©o</h1>
                <div style="display:flex; justify-content:space-between; align-items:center; margin-top:15px; border-bottom:1px solid var(--v-border); padding-bottom:25px;">
                    <span id="v-core-stats" style="color:var(--v-text-sec); font-weight:600;">0 vues ‚Ä¢ Publi√© il y a 2h</span>
                    <div style="display:flex; gap:15px; background:var(--v-card); padding:10px 25px; border-radius:50px; border:1px solid var(--v-border);">
                        <button onclick="VT.interact('like')" style="background:none; border:none; color:white; font-weight:bold; cursor:pointer; font-size:18px;">üëç <span id="v-core-likes">0</span></button>
                        <div style="width:1px; background:var(--v-border); height:20px;"></div>
                        <button onclick="VT.interact('dislike')" style="background:none; border:none; color:white; font-weight:bold; cursor:pointer; font-size:18px;">üëé</button>
                    </div>
                </div>
                <div id="v-core-author-bar" style="margin-top:30px; padding:25px; background:var(--v-card); border-radius:25px; display:flex; justify-content:space-between; align-items:center;"></div>
                
                <div style="margin-top:50px;">
                    <h3 id="com-count-label">0 Commentaires</h3>
                    <div style="display:flex; gap:20px; margin-top:25px;">
                        <img id="my-com-avatar" src="" style="width:45px; height:45px; border-radius:50%;">
                        <div style="flex:1;">
                            <input type="text" id="com-main-input" placeholder="Ajouter un commentaire public..." style="width:100%; background:transparent; border:none; border-bottom:2px solid var(--v-border); color:white; padding:10px 0; font-size:16px;">
                            <div style="display:flex; justify-content:flex-end; gap:15px; margin-top:10px;">
                                <button onclick="VT.postComment()" style="background:var(--v-accent); border:none; color:white; padding:10px 25px; border-radius:12px; font-weight:bold; cursor:pointer;">Commenter</button>
                            </div>
                        </div>
                    </div>
                    <div id="com-display-list" style="margin-top:40px; display:flex; flex-direction:column; gap:30px;"></div>
                </div>
            </div>
            <div id="v-core-suggestions" style="display:flex; flex-direction:column; gap:20px;"></div>
        </div>
    </div>

    <div id="auth-modal">
        <div class="auth-card">
            <h2 style="text-align:center; font-size:32px; margin-bottom:10px; font-weight:900;">Acc√®s Alpha</h2>
            <p style="text-align:center; color:var(--v-text-sec); margin-bottom:35px;">Rejoignez l'√©cosyst√®me Visiona</p>
            <input type="text" id="auth-pseudo" class="auth-input" placeholder="Pseudo unique">
            <input type="email" id="auth-email" class="auth-input" placeholder="Adresse Email">
            <input type="password" id="auth-pass" class="auth-input" placeholder="Mot de passe">
            <button onclick="VT.authLogin()" class="auth-btn" style="margin-top:15px;">D√âVERROUILLER</button>
            <p style="text-align:center; margin-top:25px; font-size:13px; color:var(--v-text-sec);">En continuant, vous acceptez les protocoles Alpha.</p>
        </div>
    </div>

    <script>
        /**
         * ============================================================================================
         * VISIONA TITAN ENGINE V35.0
         * LOGIQUE D'√âTAT CENTRALIS√âE ET MOTEUR DE NAVIGATION ASYNCHRONE
         * ============================================================================================
         */

        const DATABASE_URL = "https://gist.githubusercontent.com/AlphaGames30/5248424f9cc79feb78c0560faad87c92/raw/video.json";
        const WORKER_ENDPOINT = "https://mytubeupload.edonis-imbert.workers.dev/";

        const VT = {
            // √âtat de l'application
            state: {
                user: JSON.parse(localStorage.getItem('vt_v35_user')) || null,
                db: { videos: [], users: {}, thanks: [] },
                subscriptions: JSON.parse(localStorage.getItem('vt_v35_subs')) || [],
                history: JSON.parse(localStorage.getItem('vt_v35_history')) || [],
                stats: JSON.parse(localStorage.getItem('vt_v35_stats')) || { views: 0, minutes: 0, credits: 0 },
                activeVideo: null,
                viewingProfile: null,
                isMatrix: false,
                eggCounter: 0
            },

            // --------------------------------------------------------------------------
            // 1. INITIALISATION DU SYST√àME
            // --------------------------------------------------------------------------
            async init() {
                console.log("%c [VISIONA TITAN ACTIVE] ", "background: #7c4dff; color: white; padding: 10px; border-radius: 5px;");
                
                await this.syncRemoteData();
                this.renderAuthZone();
                this.refreshSidebarSubs();
                this.navigate('home');
                this.initInternalEvents();
                
                // Trackers
                setInterval(() => { if(this.state.activeVideo) this.state.stats.minutes += 0.5; this.saveLocalStorage(); }, 30000);
            },

            async syncRemoteData() {
                try {
                    const response = await fetch(`${DATABASE_URL}?nocache=${Date.now()}`);
                    this.state.db = await response.json();
                } catch(e) { 
                    console.error("[CRITICAL] Sync Failed", e); 
                    alert("Erreur de synchronisation avec le Gist.");
                }
            },

            async pushToCloud() {
                try {
                    await fetch(WORKER_ENDPOINT, {
                        method: 'PATCH',
                        body: JSON.stringify({
                            files: { "video.json": { content: JSON.stringify(this.state.db, null, 2) } }
                        })
                    });
                } catch(e) { console.log("[PUSH] Worker busy or offline"); }
            },

            saveLocalStorage() {
                localStorage.setItem('vt_v35_user', JSON.stringify(this.state.user));
                localStorage.setItem('vt_v35_subs', JSON.stringify(this.state.subscriptions));
                localStorage.setItem('vt_v35_history', JSON.stringify(this.state.history));
                localStorage.setItem('vt_v35_stats', JSON.stringify(this.state.stats));
            },

            // --------------------------------------------------------------------------
            // 2. MOTEUR DE NAVIGATION (D√âTAILL√â)
            // --------------------------------------------------------------------------
            navigate(target) {
                const sections = ['view-home', 'view-zapps', 'view-history', 'view-profile', 'view-admin'];
                sections.forEach(s => document.getElementById(s).style.display = 'none');
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));

                const viewEl = document.getElementById(`view-${target}`);
                if(viewEl) viewEl.style.display = 'block';
                
                const menuEl = document.getElementById(`menu-${target}`);
                if(menuEl) menuEl.classList.add('active');

                if(target === 'home') this.renderHomeGrid();
                if(target === 'zapps') this.renderZappsFormat();
                if(target === 'history') this.renderDashboard();
                if(target === 'profile') this.renderProfilePage();

                window.scrollTo(0, 0);
            },

            // --------------------------------------------------------------------------
            // 3. RENDERING ENGINE (HOME & ZAPPS)
            // --------------------------------------------------------------------------
            renderHomeGrid() {
                const container = document.getElementById('home-grid-container');
                const vids = this.state.db.videos.filter(v => !v.isShort);
                
                container.innerHTML = vids.map(v => `
                    <div class="v-card" onclick="VT.openPlayer('${v.id}')">
                        <div class="v-thumb-wrapper">
                            <img src="${v.thumb}" loading="lazy">
                        </div>
                        <div class="v-meta">
                            <img src="${this.getAvatar(v.author)}" class="v-pdp" onclick="event.stopPropagation(); VT.openUserProfile('${v.author}')">
                            <div>
                                <h3 style="font-size:15px; font-weight:800; line-height:1.4;">${v.title}</h3>
                                <p style="font-size:13px; color:var(--v-text-sec); margin-top:5px;">${v.author}</p>
                                <p style="font-size:12px; color:var(--v-text-sec);">${this.formatViews(v.views)} ‚Ä¢ ${this.timeAgo(v.timestamp)}</p>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            renderZappsFormat() {
                const container = document.getElementById('zapps-wrapper');
                const shorts = this.state.db.videos.filter(v => v.isShort);
                
                container.innerHTML = shorts.map(s => `
                    <div class="zapp-frame">
                        <video src="${s.url}" class="zapp-video" loop autoplay muted onclick="this.paused ? this.play() : this.pause()"></video>
                        <div class="zapp-controls">
                            <div class="z-btn" onclick="VT.zappInteract('${s.id}', 'like')">‚ù§Ô∏è</div>
                            <span style="font-size:12px; font-weight:800;">${this.formatViews(s.likes)}</span>
                            <div class="z-btn" onclick="VT.openPlayer('${s.id}')">üí¨</div>
                            <div class="z-btn">üîó</div>
                        </div>
                        <div class="zapp-overlay">
                            <div style="display:flex; align-items:center; gap:12px; margin-bottom:15px;" onclick="VT.openUserProfile('${s.author}')">
                                <img src="${this.getAvatar(s.author)}" style="width:40px; height:40px; border-radius:50%; border:2px solid #fff;">
                                <b style="font-size:17px;">@${s.author}</b>
                                <button style="background:#fff; color:#000; border:none; padding:6px 15px; border-radius:20px; font-weight:800; font-size:12px;">Suivre</button>
                            </div>
                            <p style="font-size:15px; line-height:1.4;">${s.title}</p>
                        </div>
                    </div>
                `).join('');
            },

            // --------------------------------------------------------------------------
            // 4. PLAYER ARCHITECTURE & INTERACTIONS
            // --------------------------------------------------------------------------
            openPlayer(id) {
                const video = this.state.db.videos.find(v => v.id == id);
                if(!video) return;

                this.state.activeVideo = video;
                video.views = (video.views || 0) + 1;
                this.state.stats.views++;
                
                // Add to history
                this.state.history = this.state.history.filter(h => h.id !== id);
                this.state.history.unshift(video);
                if(this.state.history.length > 20) this.state.history.pop();

                document.getElementById('master-player-overlay').style.display = 'block';
                document.getElementById('v-core-engine').src = video.url;
                document.getElementById('v-core-title').innerText = video.title;
                document.getElementById('v-core-likes').innerText = this.formatViews(video.likes);
                document.getElementById('v-core-stats').innerText = `${this.formatViews(video.views)} vues ‚Ä¢ ${this.timeAgo(video.timestamp)}`;
                
                this.renderPlayerAuthorZone();
                this.renderComments();
                this.renderSuggestions();
                this.saveLocalStorage();
                this.pushToCloud();
            },

            renderPlayerAuthorZone() {
                const author = this.state.activeVideo.author;
                const isSub = this.state.subscriptions.includes(author);
                const subCount = this.state.db.users[author]?.subscribersCount || 0;

                document.getElementById('v-core-author-bar').innerHTML = `
                    <div style="display:flex; align-items:center; gap:18px; cursor:pointer;" onclick="VT.openUserProfile('${author}')">
                        <img src="${this.getAvatar(author)}" style="width:55px; height:55px; border-radius:50%; border:2px solid var(--v-border);">
                        <div>
                            <h4 style="font-size:19px; font-weight:900;">${author}</h4>
                            <p style="color:var(--v-text-sec); font-size:13px;">${this.formatViews(subCount)} abonn√©s</p>
                        </div>
                    </div>
                    <button onclick="VT.toggleSubscription('${author}')" style="background:${isSub ? 'var(--v-card)' : '#fff'}; color:${isSub ? '#fff' : '#000'}; border:${isSub ? '1px solid var(--v-border)' : 'none'}; padding:14px 35px; border-radius:15px; font-weight:900; cursor:pointer;">
                        ${isSub ? 'ABONN√â' : "S'ABONNER"}
                    </button>
                `;
            },

            interact(type) {
                if(!this.state.user) return this.showAuth();
                const v = this.state.activeVideo;
                if(type === 'like') {
                    v.likes = (v.likes || 0) + 1;
                    document.getElementById('v-core-likes').innerText = this.formatViews(v.likes);
                }
                this.pushToCloud();
            },

            postComment() {
                const input = document.getElementById('com-main-input');
                if(!input.value || !this.state.user) return;

                const com = {
                    author: this.state.user.name,
                    text: input.value,
                    timestamp: Date.now()
                };

                if(!this.state.activeVideo.comments) this.state.activeVideo.comments = [];
                this.state.activeVideo.comments.unshift(com);
                
                input.value = "";
                this.renderComments();
                this.pushToCloud();
            },

            renderComments() {
                const list = document.getElementById('com-display-list');
                const coms = this.state.activeVideo.comments || [];
                document.getElementById('com-count-label').innerText = `${coms.length} Commentaires`;

                list.innerHTML = coms.map(c => `
                    <div style="display:flex; gap:20px;">
                        <img src="${this.getAvatar(c.author)}" style="width:42px; height:42px; border-radius:50%;">
                        <div>
                            <div style="display:flex; align-items:center; gap:10px;">
                                <b style="font-size:14px;">@${c.author}</b>
                                <span style="font-size:12px; color:var(--v-text-sec);">${this.timeAgo(c.timestamp)}</span>
                            </div>
                            <p style="margin-top:8px; font-size:15px; line-height:1.5; color:rgba(255,255,255,0.9);">${c.text}</p>
                            <div style="display:flex; gap:20px; margin-top:12px; font-size:12px; color:var(--v-text-sec); font-weight:800;">
                                <span style="cursor:pointer;">üëç</span>
                                <span style="cursor:pointer;">R√©pondre</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            },

            // --------------------------------------------------------------------------
            // 5. PROFILE SYSTEM (DETAILED TABS)
            // --------------------------------------------------------------------------
            openUserProfile(pseudo) {
                this.state.viewingProfile = pseudo;
                this.navigate('profile');
            },

            renderProfilePage() {
                const pseudo = this.state.viewingProfile || this.state.user?.name;
                if(!pseudo) return;

                const userData = this.state.db.users[pseudo] || { bio: "Canal Visiona Alpha", banner: "linear-gradient(45deg, #1a1a1a, #000)", pdp: this.getAvatar(pseudo), subscribersCount: 0 };
                
                document.getElementById('p-hero').style.background = userData.banner.startsWith('http') ? `url(${userData.banner})` : userData.banner;
                document.getElementById('p-pdp-main').src = userData.pdp || this.getAvatar(pseudo);
                document.getElementById('p-username-display').innerText = pseudo;
                document.getElementById('p-subs-count').innerText = `${this.formatViews(userData.subscribersCount)} abonn√©s`;

                // Self-check
                const isMe = this.state.user?.name === pseudo;
                document.getElementById('p-edit-action').style.display = isMe ? 'block' : 'none';
                document.getElementById('p-logout-action').style.display = isMe ? 'block' : 'none';

                this.switchProfileTab('videos', document.querySelector('.tab-btn'));
            },

            switchProfileTab(tab, btn) {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');

                const target = document.getElementById('profile-content-target');
                const pseudo = this.state.viewingProfile || this.state.user?.name;
                const videos = this.state.db.videos.filter(v => v.author === pseudo);

                if(tab === 'videos') {
                    target.innerHTML = `<div class="video-grid">${videos.filter(v => !v.isShort).map(v => this.tplVideo(v)).join('')}</div>`;
                } else if(tab === 'zapps') {
                    target.innerHTML = `<div class="video-grid" style="grid-template-columns: repeat(5, 1fr);">${videos.filter(v => v.isShort).map(v => this.tplVideo(v)).join('')}</div>`;
                } else if(tab === 'about') {
                    target.innerHTML = `<div style="background:var(--v-card); padding:40px; border-radius:25px; border:1px solid var(--v-border);"><h3>√Ä propos de ${pseudo}</h3><p style="margin-top:20px; color:var(--v-text-sec); font-size:16px;">${this.state.db.users[pseudo]?.bio || "Aucune information suppl√©mentaire."}</p></div>`;
                } else {
                    target.innerHTML = `<div style="text-align:center; padding:100px; color:var(--v-text-sec);">Aucun contenu disponible ici.</div>`;
                }
            },

            showProfileEditor() {
                const bio = prompt("Entrez votre bio :");
                const banner = prompt("Lien de votre banni√®re (image URL) :");
                const pdp = prompt("Lien de votre photo de profil :");
                
                const me = this.state.user.name;
                if(!this.state.db.users[me]) this.state.db.users[me] = { subscribersCount:0 };
                
                if(bio) this.state.db.users[me].bio = bio;
                if(banner) this.state.db.users[me].banner = banner;
                if(pdp) this.state.db.users[me].pdp = pdp;

                this.pushToCloud();
                this.renderProfilePage();
            },

            // --------------------------------------------------------------------------
            // 6. DASHBOARD & HISTORY
            // --------------------------------------------------------------------------
            renderDashboard() {
                document.getElementById('st-views').innerText = this.state.stats.views;
                document.getElementById('st-time').innerText = Math.floor(this.state.stats.minutes) + " min";
                document.getElementById('st-creds').innerText = this.state.stats.credits + " CR";
                
                const list = document.getElementById('history-list');
                if(this.state.history.length === 0) {
                    list.innerHTML = `<p style="grid-column: 1/-1; text-align:center; padding:50px; color:var(--v-text-sec);">Votre historique est vide.</p>`;
                    return;
                }
                list.innerHTML = this.state.history.map(v => this.tplVideo(v)).join('');
            },

            // --------------------------------------------------------------------------
            // 7. SUBSCRIPTION LOGIC
            // --------------------------------------------------------------------------
            toggleSubscription(author) {
                if(!this.state.user) return this.showAuth();
                if(author === this.state.user.name) return alert("Vous ne pouvez pas vous abonner √† vous-m√™me.");

                const index = this.state.subscriptions.indexOf(author);
                if(!this.state.db.users[author]) this.state.db.users[author] = { subscribersCount: 0 };

                if(index > -1) {
                    this.state.subscriptions.splice(index, 1);
                    this.state.db.users[author].subscribersCount = Math.max(0, this.state.db.users[author].subscribersCount - 1);
                } else {
                    this.state.subscriptions.push(author);
                    this.state.db.users[author].subscribersCount++;
                }

                this.saveLocalStorage();
                this.refreshSidebarSubs();
                this.renderPlayerAuthorZone();
                this.pushToCloud();
            },

            refreshSidebarSubs() {
                const list = document.getElementById('sidebar-subscriptions-list');
                if(this.state.subscriptions.length === 0) {
                    list.innerHTML = `<p style="font-size:12px; color:var(--v-text-sec); padding:15px;">Aucun abonnement.</p>`;
                    return;
                }
                list.innerHTML = this.state.subscriptions.map(s => `
                    <div class="sub-item" onclick="VT.openUserProfile('${s}')">
                        <img src="${this.getAvatar(s)}">
                        <span style="font-size:14px; font-weight:700;">${s}</span>
                    </div>
                `).join('');
            },

            // --------------------------------------------------------------------------
            // 8. AUTH & ADMIN
            // --------------------------------------------------------------------------
            authLogin() {
                const pseudo = document.getElementById('auth-pseudo').value;
                const email = document.getElementById('auth-email').value;
                const pass = document.getElementById('auth-pass').value;

                if(!pseudo || !email.includes('@') || pass.length < 4) {
                    alert("Veuillez remplir les champs correctement (Mot de passe : 4 car. min)");
                    return;
                }

                this.state.user = { name: pseudo, email: email };
                this.saveLocalStorage();
                
                if(!this.state.db.users[pseudo]) {
                    this.state.db.users[pseudo] = { subscribersCount: 0, bio: "Nouveau membre Visiona", banner: "linear-gradient(45deg, #7c4dff, #000)" };
                    this.pushToCloud();
                }
                
                location.reload();
            },

            logout() { localStorage.removeItem('vt_v35_user'); location.reload(); },

            renderAuthZone() {
                const entry = document.getElementById('auth-entry-point');
                if(this.state.user) {
                    entry.innerHTML = `<img src="${this.getAvatar(this.state.user.name)}" style="width:45px; height:45px; border-radius:50%; cursor:pointer; border:2px solid var(--v-border);" onclick="VT.openUserProfile('${this.state.user.name}')">`;
                    document.getElementById('v-balance').innerText = `${this.state.stats.credits} CR`;
                    document.getElementById('my-com-avatar').src = this.getAvatar(this.state.user.name);
                    if(this.state.user.name === "Admin") document.getElementById('admin-access').style.display = 'block';
                } else {
                    entry.innerHTML = `<button onclick="VT.showAuth()" style="background:var(--v-accent); color:white; border:none; padding:12px 25px; border-radius:14px; font-weight:800; cursor:pointer;">Connexion</button>`;
                }
            },

            adminCredits() {
                const pseudo = document.getElementById('adm-pseudo').value;
                const val = parseInt(document.getElementById('adm-val').value);
                if(!this.state.db.users[pseudo]) return alert("Utilisateur inconnu");
                // On mettrait ici une logique de modification de l'√©tat global
                alert(`Action admin effectu√©e pour ${pseudo}`);
            },

            // --------------------------------------------------------------------------
            // 9. UTILS & TEMPLATES
            // --------------------------------------------------------------------------
            tplVideo(v) {
                return `
                    <div class="v-card" onclick="VT.openPlayer('${v.id}')">
                        <div class="v-thumb-wrapper"><img src="${v.thumb}"></div>
                        <div class="v-meta">
                            <img src="${this.getAvatar(v.author)}" class="v-pdp">
                            <div>
                                <h3 style="font-size:14px;">${v.title}</h3>
                                <p style="font-size:12px; color:var(--v-text-sec);">${v.author} ‚Ä¢ ${v.views} vues</p>
                            </div>
                        </div>
                    </div>
                `;
            },

            getAvatar(name) { return `https://ui-avatars.com/api/?name=${name}&background=1a1a1a&color=fff&bold=true`; },
            formatViews(n) { if(!n) return 0; if(n >= 1000000) return (n/1000000).toFixed(1) + 'M'; if(n >= 1000) return (n/1000).toFixed(1) + 'k'; return n; },
            timeAgo(ts) {
                if(!ts) return "il y a 10m";
                const diff = (Date.now() - ts) / 1000;
                if(diff < 3600) return "il y a " + Math.floor(diff/60) + "m";
                if(diff < 86400) return "il y a " + Math.floor(diff/3600) + "h";
                return "il y a " + Math.floor(diff/86400) + "j";
            },

            showAuth() { document.getElementById('auth-modal').style.display = 'flex'; },
            closePlayer() { 
                document.getElementById('master-player-overlay').style.display = 'none'; 
                document.getElementById('v-core-engine').pause(); 
            },

            initInternalEvents() {
                // Easter Eggs
                document.getElementById('logo-v').onclick = () => {
                    this.state.eggCounter++;
                    if(this.state.eggCounter === 10) {
                        this.state.stats.credits += 5000;
                        alert("PROTOCOL OVERRIDE: +5000 CR√âDITS ALPHA !");
                        this.renderAuthZone();
                    }
                };
                // Search action on Enter
                document.getElementById('main-search-input').onkeydown = (e) => { if(e.key === 'Enter') this.searchAction(); };
            }
        };

        // LANCEMENT
        window.onload = () => VT.init();
    </script>
</body>
</html>
